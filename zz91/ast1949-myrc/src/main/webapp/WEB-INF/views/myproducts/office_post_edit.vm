#set( $layout = "/layout/default.vm" )
<script src="$!{address.img}/lib/asto/asto-all-1.0.0.js"></script>
<script type="text/javascript" src="$!{address.img}/zz91/js/openoverlay.js"></script>
<link type="text/css" rel="stylesheet" href="$!{address.img}/zz91/css/openoverlay2.css" />
<script type="text/javascript" src="$!{address.img}/bbs/js/ckeditor/ckeditor.js"></script>

<link rel="stylesheet" href="$!{address.img}/zz91/myrc/css/myproducts.css" />
<script src="$!{address.img}/zz91/myrc/js/myproducts.js"></script>
<div class="container mt clearfix">

<div class="SonlineBox" id="SonlineBox">
	<div class="contentBox">
		<div class="titleBox">完整度：<span id="num"></span>%</div>##$!{productsDO.score}
		<div class="listBox">
			<table class="tab-list" cellpadding="0" cellspacing="0">
##				#set($score = $!{productsDO.score}/20)
				<tr><th><i id="cmpltlvl" class="lv$!{score}"></i>产品星级:</th></tr>
				<tr><td><a action-data="1F" onclick="bookmarks(this);"><i class="gtick"></i><span>完善交易条件</span></a></td></tr>
				<tr><td><a action-data="2F" onclick="bookmarks(this);"><i class="gtick"></i><span>完善产品属性</span></a></td></tr>
				<tr><td><a #if(!$sample) href="#springUrl('/myproducts/office_img.htm?productsId=')$!{productsDO.id}" target="_blank" #end action-data="3F" onclick="bookmarks(this);"><i class="gtick"></i><span>上传产品图片</span></a></td></tr>
				<tr><td><a action-data="4F" onclick="bookmarks(this);"><i class="gtick"></i><span>丰富信息描述</span></a></td></tr>
				<tr><td><a href="http://help.zz91.com/detail-124/" target="_blank" class="case">查看优质案例</a></td></tr>
			</table>
		</div>
	</div>
</div>
<script language="javascript" src="$!{address.img}/zz91/myrc/js/jquery.Sonline2.js"></script> 
	<div class="grid_12">
        <ul class="breadcrumb" id="4F">
            <li>
                <a href="#springUrl('/myproducts/office_post_list.htm?checkStatus=1&isExpired=0&isPause=0')">商机管理</a> <span class="divider">/</span>
            </li>
            <li class="active">编辑供求信息</li>
        </ul>
		<form id="editForm" name="editForm" method="post" action="#springUrl('/myproducts/editProducts.htm')">
			<input type="hidden" name="id" id="id" value="$!{productsDO.id}">
			<input type="hidden" name="isPause" value="$!{productsDO.isPause}"/>
			<input type="hidden" id="limitCount"name="limitCount" value="$!{limitCount}"/>
    		<input id="categoryProductsMainCode" type="hidden" name="categoryProductsMainCode" value="$!{productsDO.categoryProductsMainCode}">
			<!-- part I Start -->
    		<h3 class="divide">一、供求基本信息</h3>
			<div class="control-group">
				<label class="control-label">
					<span class="red">*</span>产品类型：
				</label>
				<div class="controls">
				#foreach($!products in $!productsTypeList)
					<label class="radio">
						<input name="productsTypeCode" type="radio"  value="$!{products.code}" #if($!{productsDO.productsTypeCode}==$!{products.code}) checked #end #if($!{sample}||$!{ypStatus}==1) disabled="true" #end >$!{products.label}信息
					</label>
				#end
				</div>
			</div>
			
    		<div class="control-group">
				<label for="title" class="control-label">
					<span class="red">*</span>产品名称：
				</label>
				<div class="controls">
					<input name="title" type="text" id="title" value="$!{productsDO.title}" class="field validate[required,maxSize[50]]">
				</div>
			</div>
			<div class="control-group mt">
				<label for="tags" class="control-label">
					<span class="red">*</span>产品标签：
				</label>
				<div class="controls">
					<input name="tags" type="text" id="tags" size="100" value="$!{productsDO.tags}" class="field input-large validate[required,maxSize[100]]">
				</div>
    		</div>
			
			<div class="control-group">
				<label class="control-label">
					<span class="red">*</span>所属类别：
				</label>
				<div class="controls">
					<p>
						<select id='c1' name='c1' class="validate[required]">
                        	<option value="">--请选择主类别--</option>
                    	</select>
                    </p>
                    <select id='c2' name='c2' size='10' class="validate[required]">
                        <option value="">--二级分类--</option>
                    </select>
                    <select id='c3' name='c3' size='10' >
                        <option value="">--三级分类--</option>
                    </select>
                    <select id='c4' name='c4' size='10' >
                        <option value="">--四级分类--</option>
                    </select>
            		<select id='ac' name='categoryProductsAssistCode' size='10' >
                        <option value="">--请选择辅助类别--</option>
                    </select>
				</div>
			</div>
			
			<style>
				#cke_13{display:none;}
				#cke_14{display:none;}
			</style>
			<div class="control-group">
				<label for="details" class="control-label">
					<span class="red">*</span>信息描述：
				</label>
				<div class="controls">
					<input type="button" class="btn" value="自动生成信息描述" onclick="appendDetail()"/>
					<input type="button" class="btn" onclick="upload()" value="插入图片"/>
					<br/>
					<textarea name="details" cols="80" rows="10" id="content">$!{productsDO.details} </textarea>
				</div>
			</div>
			
			<script type="text/javascript">
				var ckeditor
    			jQuery(document).ready(function() {
					
					if(!+[1,]){
						
						ckeditor = {
							getData : function(){
								return jQuery("#content").val();
							},
							insertHtml : function(img){
								jQuery("#content").val(jQuery("#content").val()+img);
							}
						}
						
					}else{

            			ckeditor=CKEDITOR.replace("content",{
           			      	toolbar:[
      								 ['Bold','Italic','Underline','Strike','Outdent','Indent','-','NumberedList','BulletedList'],
    	   							 ['NumberedList','BulletedList'],
        							 ['JustifyLeft','JustifyCenter','JustifyRight','JustifyBlock'],['Maximize'],
    					   ],
    		               uiColor : '#fff',
                           language : 'zh-cn',
    					   height:200,
    					   width :600,
    					   enterMode:CKEDITOR.ENTER_BR,
    					   shiftEnterMode:CKEDITOR.ENTER_P,
    					   on:{
    							focus:function(){
    								jQuery("#detailsFlag").val("1");
    								jQuery("#ckeditorFlag").val("1");
    							}
    						}
    					});	
        				## 绑定事件
            			CKEDITOR.instances["content"].on("instanceReady", function () {  
                            //set keyup event
                            this.document.on("keyup", starCount);
                            //and click event
                            this.document.on("blur", starCount);
            				// set mouseleave event
            				this.document.on("mouseleave",starCount);
                        });
					}
	            });
				
			</script>

			<!-- <div class="alert alert-info mt"> 
				<strong>小窍门：</strong>给你的供求信息贴上标签，让客户更快更准找到你！多个标签用逗号隔开！
				<a href="http://www.zz91.com/cn/helpcenter/news.asp?id=392" target="_blank" id="linktags" title="点击查看在线帮助，教你如何填写标签">怎样填标签？</a>
        	</div> -->
			
			<!-- part I End -->
			<!-- part II Start -->
			<h3 class="divide"  id="2F">二、产品属性</h3>

			<div class="control-group hidden" id="color_item">
				<label class="control-label">
					#if($!{sample})
						<span class="red">*</span>
					#end
					颜色：
				</label>
				<div class="controls">
					<input type="text" name="color" id="color" value="$!{productsDO.color}" #if($!{sample}) class="field input-small validate[required]" #else class="field input-small"  #end style="width:280px" />
					（如：本色、白色、黑色、灰色、红色、蓝色、杂色等）
				</div>
			</div>
			
			<div class="control-group hidden" id="grade_item">
				<label class="control-label">
					品位：
				</label>
				<div class="controls">
					<input type="text" id="grade" class="field input-small" name = "grade" value="$!{grade}" style="width:280px"/>
				</div>
			</div>
			
			<div class="control-group hidden" id="shape_item">
				<label class="control-label">
					#if($!{sample})
						<span class="red">*</span>
					#end
					形态：
				</label>
				<div class="controls">
					<input type="text" id="shape" name="shape" value="$!{spot.shape}" #if($!{sample}) id="shape" class="field input-small validate[required]" #else class="field input-small" #end style="width:280px"/>
					（如：片状、颗粒、破碎、原状未加工、其他）
				</div>
			</div>
			
##            <div class="b-item hidden" id = "level_item">
##            	<div class="b-item-title fl ">
##                	级别：
##                </div>
##                <input type="text" class="b-item-text fl field input-small" name = "level" value="$!{spot.level}"/>
##                <div class="b-item-info fl ">
##                	（如：特级、一级、二级、其他）
##                </div>
##                <div class="cb"></div>
##            </div>
##            <!--end b-item-->
			
			<div class="control-group hidden" id="level_item">
				<label class="control-label">
					#if($!{sample})
						<span class="red">*</span>
					#end
					级别：
				</label>
				<div class="controls">
					<input type="text" id = "level" name = "level" value="$!{spot.level}" #if($!{sample}) id="level" class="field input-small validate[required]" #else class="field input-small " #end style="width:280px" />
						（如：特级、一级、二级、其他）
				</div>
			</div>
			
##            <div class="b-item hidden" id = "appearance_item">
##            	<div class="b-item-title fl ">
##                	外观：
##                </div>
##                <input type="text" class="b-item-text fl field input-small" name = "appearance" value="$!{productsDO.appearance}"/>
##                <div class="b-item-info fl ">
##                	（如：光滑、干净、未处理、其他）
##                </div>
##                <div class="cb"></div>
##            </div>
##            <!--end b-item-->
			
			<div class="control-group hidden" id="appearance_item">
				<label class="control-label">
					外观：
				</label>
				<div class="controls">
					<input type="text" id="appearance" class="field input-small " name = "appearance" style="width:280px"  value="$!{productsDO.appearance}" />
					（如：光滑、干净、未处理、其他）
				</div>
			</div>
			
##			<div class="b-item " id = "source_item">
##            	<div class="b-item-title fl ">
##                	货源地：
##                </div>
##                <input type="text" class="b-item-text fl field input-small" name = "source" value="$!{productsDO.source}"/>
##                <div class="b-item-info fl ">
##                	（此货物来源地，如：国外、美国、国内...）
##                </div>
##                <div class="cb"></div>
##            </div>
##            <!--end b-item-->
			
			<div class="control-group">
				<label class="control-label">
					货源地：
				</label>
				<div class="controls">
					<input type="text" id="source" class="field input-small " name = "source" style="width:280px" value="$!{productsDO.source}" />
					（此货物来源地，如：国外、美国、国内...）
				</div>
			</div>
			
##            <div class="b-item" id = "origin_item">
##            	<div class="b-item-title fl ">
##                	来源产品：
##                </div>
##                <input type="text" class="b-item-text fl field input-small" name = "origin" value="$!{productsDO.origin}"/>
##                <div class="b-item-info fl ">
##                	
##                </div>
##                <div class="cb"></div>
##            </div>
##            <!--end b-item-->
			
			<div class="control-group">
				<label class="control-label">
					来源产品：
				</label>
				<div class="controls">
					<input type="text" id="origin" class="field input-small " name = "origin" style="width:280px"  value="$!{productsDO.origin}" />
				</div>
			</div>
			
##			<div class="b-item" id = "specification_item">
##            	<div class="b-item-title fl ">
##                	产品规格：
##                </div>
##                <input type="text" class="b-item-text fl field input-small" name = "specification" value="$!{productsDO.specification}"/>
##                <div class="b-item-info fl ">
##                	（如：产品大小30cm*50cm、厚度20mm...）
##                </div>
##                <div class="cb"></div>
##            </div>
##            <!--end b-item-->
			
			<div class="control-group" >
				<label class="control-label">
					产品规格：
				</label>
				<div class="controls">
					<input type="text" id="specification" class="field input-small" name = "specification" style="width:280px" value="$!{productsDO.specification}" />
					（如：产品大小30cm*50cm、厚度20mm...）
				</div>
			</div>
			
##            <div class="b-item hidden" id="useful_item">
##            	<div class="b-item-title fl ">
##                	此废料可用于：
##                </div>
##                <input type="text" class="b-item-text fl field input-small" name="useful" value="$!{productsDO.useful}"/>
##                <div class="b-item-info fl ">
##                	（此货品加工后的用途，如：造粒、注塑...）
##                </div>
##                <div class="cb"></div>
##            </div>
##            <!--end b-item-->
			
			<div class="control-group hidden" id="useful_item">
				<label class="control-label">
					#if($!{sample})
						<span class="red">*</span>
					#end
					此废料可用于：
				</label>
				<div class="controls">
					<input type="text" id="useful" name="useful" value="$!{productsDO.useful}" #if($!{sample}) id="useful" class="field input-small  validate[required]" #else class="field input-small " #end style="width:280px"  />
					（此货品加工后的用途，如：造粒、注塑...）
				</div>
			</div>
			
         
			
			<div class="control-group hidden" id="impurity_item">
				<label class="control-label">
					杂质（杂物）含量：
				</label>
				<div class="controls">
					<input type="text" id="impurity" class="field input-small validate[maxSize[20]]" name="impurity" value="$!{productsDO.impurity}" style="width:280px" />
					（请写明具体杂质及其含量）
				</div>
			</div>
		
			<div class="control-group">
				<label class="control-label">加工说明：</label>
					#foreach($manu in $!manufactureList)
						<label class="radio"><input type="radio" name="manufacture" value="$!{manu.code}" #if($!{productsDO.manufacture}==$!{manu.code})checked#end> $!{manu.label}</label>
					#end
                <div class="cb"></div>
            </div>
			<div class="b-item hidden" id ="addProp_item">
                <div id="item">
    			#foreach($pap in $!productAddProperties)
					#if($velocityCount==1)
						#set( $velocityCount = $velocityCount - 2)
					#else
						#set( $velocityCount = $velocityCount - 1)
					#end
    				<div class="b-item1" id = "prop$velocityCount" >
    					<div class="b-item-title">
    						<input type="text" class="b-item-text5 field input-small" onclick=itemtext1(this) value="$!{pap.property}" name = "property"  id = "property$velocityCount" />：</div>
    					<div class="b-item-info2">
    						<input type="text" class="b-item-text6 field input-small" onclick=itemtext2(this) onblur="starCount()" value="$!{pap.content}" name="content" id = "content$velocityCount"/></div>
    					<div class="b-item-info"><a href="javascript:deleteProperty('property$velocityCount','prop$velocityCount');">删除</a><span class="tag" id="span$velocityCount"></span></div>
    					<input type="hidden" name="propertyId" id="propertyId$velocityCount" value="$!{pap.id}" />
						<div class="cb"></div>
    				</div>
				#end
				</div>
				<div class="b-item hidden" id = "add_tishi">
                	<p style="color:#f00; margin-left:88px;"><strong><b>注. 属性和属性值</b></strong>都不能含有逗号(,)。如果需要则用顿号(、)代替。
                    </p>
                    <p style="color:#f00; margin-left:88px;"><strong><b>1. 属性：</b></strong>请根据具体产品填写，例如废金属，属性一栏可填写品位，形态，颜色等
                    </p>
					<p style="color:#f00; margin-left:88px;"><strong><b>2. 属性值：</b></strong>请根据属性填写，例如属性为颜色，属性值则为红色
                    </p>
                </div>
                <div class="b-item">
                	<div class="b-item-addimg fl">
                    	<a href="#"></a>
                    </div>
                    <div class="b-item-addtext fl" id="item-addtext" >
                    	<a id="additem">添加产品属性</a>
                        如果您觉得我们提供的产品属性无法满足您的需要，您可以手动添加产品属性
                    </div>
                    <div class="cb"></div>
                </div>
            </div>
			
			#set($typename = "供应")
    		#if($!{productsDO.productsTypeCode}=="10331001")
    			#set($typename = "求购")
			#elseif($!{productsDO.productsTypeCode}=="10331002")
				#set($typename = "合作")
    		#end
			<!-- part III Start -->
			<h3 class="divide" id="1F">三、交易条件</h3>
			<div class="control-group">
				<label class="control-label">期货现货：</label> 
				<div class="controls">
				#foreach($goods in $!goodsTypeList)
					<label class="radio">
						<input type="radio" name="goodsTypeCode" value="$!{goods.code}" #if($!{productsDO.goodsTypeCode}==$!{goods.code})checked#end />
							$!{goods.label}
					</label>
				#end
				</div>
			</div>
			<div class="control-group">
				<label for="useful" class="control-label">
					<span class="red">*</span>$!{typename}数量：
				</label>
				<div class="controls">
					<input name="quantity" type="text" id="quantity" value="$!{productsDO.quantity}" class="field validate[required,custom[integer]]" maxlength="6">
				</div>
			</div>
			<div class="control-group">
				<label for="useful" class="control-label">计量单位：</label>
				<div class="controls">
					<label class="radio"><input type="radio" name="quantityUnit" value='吨' #if($!{productsDO.quantityUnit}=="吨") checked #end />吨</label>
					<label class="radio"><input type="radio" name="quantityUnit" value='千克' #if($!{productsDO.quantityUnit}=="千克") checked #end />千克</label>
					<label class="radio"><input type="radio" name="quantityUnit" value='斤' #if($!{productsDO.quantityUnit}=="斤") checked #end />斤</label>
					<label class="radio"><input type="radio" name="quantityUnit" value='台' #if($!{productsDO.quantityUnit}=="台") checked #end />台</label>
					<label class="radio"><input type="radio" name="quantityUnit" value='辆' #if($!{productsDO.quantityUnit}=="辆") checked #end />辆</label>
					#if($!{productsDO.quantityUnit}=="吨" || $!{productsDO.quantityUnit}=="千克" || $!{productsDO.quantityUnit}=="斤" || $!{productsDO.quantityUnit}=="台" || $!{productsDO.quantityUnit}=="辆") 
						<label class="radio">
							<input type="radio" name="quantityUnit" value='' id="myQuantityUnit" />其他：
						</label>
						<input type="text" value="" onblur="ortherInput('myQuantityUnit',this.value);" class="field">
					#else
						<label class="radio">
							<input type="radio" name="quantityUnit" value='$!{productsDO.quantityUnit}' id="myQuantityUnit" checked/>其他：
						</label>
						<input type="text" value="$!{productsDO.quantityUnit}" onblur="ortherInput('myQuantityUnit',this.value);" class="field">
					#end
				</div>
			</div>
			
##			<div class="control-group">
##				<label for="totalQuantity" class="control-label">${typename}总量：</label> 
##				<div class="controls">
##					<input name="totalQuantity" type="text" id="totalQuantity" value="$!{productsDO.totalQuantity}" class="field validate[custom[number]]"> 
##				</div>
##			</div>
           			<div class="control-group">
				<label for="totalQuantity" class="control-label">公开报价</label> 
				<div class="controls">
					<label class="radio">
						<input type="radio" name="opPrice" class="opPrice" value="0" #if($!{productsDO.minPrice}&&$!{productsDO.minPrice}!="0.0") checked='true' #end /> 公开报价
					</label>
					<label class="radio">
						<input type="radio" name="opPrice" class="opPrice" value="1" #if(!$!{productsDO.minPrice}||$!{productsDO.minPrice}=="0.0") checked='true' #end /> 电议或面议
					</label>
				</div>
			</div>
			<div class="control-group validatePrice">
				<label for="minPrice" class="control-label"><span class="red">*</span>报价：</label>
				<div class="controls">
					<input name="minPrice" type="text" id="minPrice" value="$!{productsDO.minPrice}" class="field validate[required,custom[number],min[1]]">
					#set($chkflag='')
					#set($displayflag='none')
					#if($!{productsDO.maxPrice} && $!{productsDO.maxPrice}>0)
						#set($chkflag='checked')
						#set($displayflag='')
					#end
					<span id="priceFlag" style='display:$!{displayflag}'>
						至
						<input name="maxPrice" type="text" id="maxPrice"   value="$!{productsDO.maxPrice}" class="field validate[custom[number],funcCall[checkMaxPrice]]">
					</span>
    				<p class="red">（请写明价格，如：50000，如果是一个价格范围，请选中以下&ldquo;支持价格范围&rdquo;）</p>
    				<label for="" class="checkbox">
    					<input type="checkbox" name="togglePrice" id="togglePrice" $!{chkflag} value="1" onclick="if(this.checked){jQuery('#priceFlag').show();}else{jQuery('#priceFlag').hide();}"/> 支持价格范围
    				</label>
				</div>
			</div>
			
			<div class="control-group validatePrice">
				<label class="control-label">价格单位：</label>
				<div class="controls">
					<label class="radio"><input type="radio" name="priceUnit" value='元' #if($!{productsDO.priceUnit}=="元")checked#end>元</label>
					<label class="radio"><input type="radio" name="priceUnit" value='美元' #if($!{productsDO.priceUnit}=="美元")checked#end style="border:none"/>美元</label>
					<label class="radio"><input type="radio" name="priceUnit" value='欧元' #if($!{productsDO.priceUnit}=="欧元")checked#end style="border:none"/>欧元</label>
					<label class="radio"><input type="radio" name="priceUnit" value='日元' #if($!{productsDO.priceUnit}=="日元")checked#end style="border:none"/>日元</label>
					#if($!{productsDO.priceUnit}=="元" || $!{productsDO.priceUnit}=="美元" || $!{productsDO.priceUnit}=="欧元" || $!{productsDO.priceUnit}=="日元")
    					<label class="radio">
    						<input type="radio" name="priceUnit" value='' id="myPriceUnit">其他：
    					</label>
    					<input id="otherUnit" type="text" value="" onblur="ortherInput('myPriceUnit',this.value);" class="field input-small">
					#else
    					<label class="radio">
    						<input type="radio" name="priceUnit" value='$!{productsDO.priceUnit}' checked id="myPriceUnit">其他：
    					</label>
    					<input id="otherUnit" type="text" value="$!{productsDO.priceUnit}" onblur="ortherInput('myPriceUnit',this.value);" class="field input-small">
					#end
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">${typename}情况：</label>
				<div class="controls">
					<label class="radio"><input type="radio" name="provideStatus" id="provideStatus" #if($!{productsDO.provideStatus}==0) checked #end value="0" onclick="document.getElementById('supplyTr').style.display='';" >
					长期${typename}</label>
					<label class="radio"><input type="radio" name="provideStatus" id="provideStatus" #if($!{productsDO.provideStatus}==1) checked #end value="1" onclick="document.getElementById('supplyTr').style.display='none';" >
    				不定期${typename}</label>
				</div>
			</div>
			
			<div class="control-group">
    			<label class="control-label">交易说明：</label>
				<div class="controls">
					<input type="radio" name="transaction" value="提供样品" #if($!spot.transaction=="提供样品"||$sample) checked #end/>提供样品
					<input type="radio" name="transaction" value="支持线下看货" #if($!spot.transaction=="支持线下看货")checked#end/>支持线下看货
        			<input type="radio" name="transaction" value="指定销售地区" id="transactionValue" #if($!spot.transaction=="指定销售地区$!{trans}")checked#end />
        			<label for="transactionValue">指定销售地区</label>
					<input type="text" class="field input-small" id="transactionArea" value="$!{trans}" />
				</div>
			</div>
			<script>
				// 指定销售地区 填写 时间
				jQuery("#transactionArea").on({
				
    			   	"blur": function(){
    				jQuery("#transactionValue").val("指定销售地区"+jQuery("#transactionArea").val())
    				},
    				"click": function(){
    				jQuery('#transactionValue').attr('checked', true);
    				}
				});
			</script>
			<div class="control-group">
    			<label class="control-label">发货时间：</label>
				<div class="controls">
					<input name="shipDay" type="text" id="shipDay" class="field input-small validate[custom[number]]" value="$!{productsDO.shipDay}">
					<span class="grey">天内可以发货</span>
				</div>
			</div>
			
			<div class="control-group">
				<label class="control-label">现货物所在地：</label>
				<div class="controls hidden" id = "address">$!{productsDO.location}&nbsp; &nbsp;&nbsp;&nbsp; <input type = "button"  onClick="setAddress()" value="重设" /></div>
				
				<div class="controls hidden" id="setAddress">
					<select id='reg-area-0'>
						<option value="">请选择国家</option>
					</select>
					<select id='reg-area-1'>
						<option value="">请选择省份</option>
					</select>
					<select id='reg-area-2'>
						<option value="">请选择城市</option>
					</select>
					<input name="location" type="hidden" id="location" class="field" value="$!{productsDO.location}" /> 
				</div>
				
			</div>
			<script type="text/javascript">
				jQuery(document).ready(function(){
    				var regarea = new Asto.util.Selector({
                		selects:["#reg-area-0","#reg-area-1","#reg-area-2"],
            			assistSelects:["#reg-garden"],
            			url:"#springUrl('/category/areaChild.htm')",
            			assistUrl:"#springUrl('/category/gardenChild.htm')",
            			changeCallback:function(c,idx){
							var address ="";
							if(jQuery("#reg-area-0").val()!=""){
                    			address =address+ jQuery("#reg-area-0").find("option:selected").text();
                    		}
                    		if(jQuery("#reg-area-1").val()!=""){
                    			address =address+ jQuery("#reg-area-1").find("option:selected").text();
                    		}
                    		if(jQuery("#reg-area-2").val()!=""){
                    			address = address+jQuery("#reg-area-2").find("option:selected").text();
                    		}
                    		jQuery("#location").val(address);
            			}
            		});
    				regarea.init({
            			rootCode:"1001",
            			initCode:"1001",
            			initAssistCode:"1001"
            		});
				});
			</script>
			
			## 样品信息隐藏
			<input type="hidden" name="sampleId" value="$!{sample.id}"/>
			<input type="hidden" name="ypStatus" value="$!{ypStatus}"/>
			
			## 样品信息存在
			#if(($!{ypStatus}==1||$sample)&&${productsDO.productsTypeCode}=="10331000")
			<div class="control-group">
				<label for="quantity" class="control-label">
					<span class="red">*</span>样品数量：
				</label>
				<div class="controls">
					<input name="amount" type="text" id="amount" class="field input-small validate[required,custom[integer],min[1]]" maxlength="6" #if(${ypStatus}&&${ypStatus}==1) #else value="$!{sample.amount}" #end  style="border:1px solid #ff822e" /> 件
				</div>
			</div>
			<div class="control-group">
				<label for="quantity" class="control-label">
					<span class="red">*</span>样品单件重量：
				</label>
				<div class="controls">
					<input name="weight" type="text" id="weight" class="field input-small validate[required,custom[number],min[0]]" maxlength="6" #if(${ypStatus}&&${ypStatus}==1) #else  value="$!{sample.weight}" #end style="border:1px solid #ff822e" /> 千克/件
				</div>
			</div>
			<div class="control-group">
				<label class="control-label"><span class="red">*</span>拿样价格：</label>
				<div class="controls">
					<input name="takePrice" type="text" id="takePrice" maxlength="6" size="10" class="field input-small validate[required,custom[number],min[1]]" #if(${ypStatus}&&${ypStatus}==1) #else value="$!{sample.takePrice}" #end style="border:1px solid #ff822e" />元
				</div>
			</div>
			<div class="control-group">
				<label class="control-label"><span class="red">*</span>运费：</label>
				<div class="controls">
				<label class="radio"><input type="radio" class="sendPriceFreeClick" name="sendPriceFreeClick" value="1"   #if(!$!{sample.sendPrice}||$!{sample.sendPrice}==0.0 )  #else checked  #end>买家承担运费</label>  
				<label class="radio"><input type="radio" class="sendPriceFreeClick" name="sendPriceFreeClick" value="0"   #if(!$!{sample.sendPrice}||$!{sample.sendPrice}==0.0 )   checked  #else   #end>免运费</label>
				<div id="sendPriceFreeDetail" style="margin-top:5px;">
					<input name="sendPrice" type="text" id="sendPrice" maxlength="6" size="10" class="field input-small validate[required,custom[number],min[1]]" #if(${ypStatus}&&${ypStatus}==1) #else value="$!{sample.sendPrice}" #end style="border:1px solid #ff822e" /> 元 &nbsp;
					<label class="checkbox"><input type="checkbox" id="isCashDelivery"   name="isCashDelivery"      value="1"   #if($!{sample.isCashDelivery}==1)  checked   #end><font color="red">支持货到付款</font> （买家收到货后，由买家支付运费）</label> 
				</div>
				</div>
			</div>
			<script type="text/javascript">
    			jQuery(".sendPriceFreeClick").click(function () {
            		var s = jQuery(":input[name='sendPriceFreeClick'][checked]").val();
            		if (s == 0) {
    					jQuery("#sendPrice").val(0);
    					jQuery("#isCashDelivery").val(0);
            			jQuery("#sendPriceFreeDetail").hide();
            			jQuery("#sendPrice").validationEngine("hide");
            		} else {
    					jQuery("#sendPrice").val("");
            			jQuery("#sendPriceFreeDetail").show();
            		}
            	});
				
				#if(!$!{sample.sendPrice}||$!{sample.sendPrice}==0.0 )   jQuery("#sendPriceFreeDetail").hide();    #end
				
			</script>
			## 发货地址
			<div class="control-group" id="J_spotAddr">
				<div class="control-group">
					<label class="control-label"><span class="red">*</span>发货地址：</label>
					<div class="controls">
						<p>
							<select id='yp-area-1' style="border:1px solid #ff822e">
								<option value="">请选择省份</option>
							</select>
							<select id='yp-area-2' class="validate[required]" style="border:1px solid #ff822e">
								<option value="">请选择城市</option>
							</select>
							<input name="areaCode" type="hidden" id="areaCode" class="field" value="$!{sample.areaCode}" />
						</p>
					</div>
				</div>
			</div>
			
			<script type="text/javascript">
				var regarea = new Asto.util.Selector({
					selects:["#yp-area-1","#yp-area-2"],
					assistSelects:["#reg-garden"],
					url:"#springUrl('/category/areaChild.htm')",
					assistUrl:"#springUrl('/category/gardenChild.htm')",
					changeCallback:function(c,idx){
						setAreaCode();
					}
				});
				regarea.init({
					rootCode:"10011000",
					#if($!{sample.areaCode}&&$!{sample.areaCode}!=""&&!${ypStatus})
						initCode:"$!{sample.areaCode}",
						initAssistCode:"$!{sample.categoryGardenId}"
					#else
						initCode:"1001",
						initAssistCode:""
					#end
				});
				function setAreaCode(){
            		var areacode=jQuery("#yp-area-1").val();
            		if(jQuery("#reg-area-1").val()!=""){
            			areacode=jQuery("#yp-area-1").val();
            		}
            		if(jQuery("#yp-area-2").val()!=""){
            			areacode=jQuery("#yp-area-2").val();
            		}
            		jQuery("#areaCode").val(areacode);
            	}
			</script>
			
			#end
			
			<div class="control-group">
				<label class="control-label"><span class="red">*</span>信息有效期：</label> 
				<div class="controls">
					<label class="radio"><input type='radio' name='postlimittime' value='365' checked/>长期有效(一年内有效)</label>
					<label class="radio"><input type='radio' name='postlimittime' value='90' #if($!day==90)checked#end	/>3个月</label>
					<label class="radio"><input type='radio' name='postlimittime' value='30' #if($!day==30)checked#end	/>1个月</label>
					<label class="radio"><input type='radio' name='postlimittime' value='20' #if($!day==20)checked#end	/>20天</label>
					<label class="radio"><input type='radio' name='postlimittime' value='10' #if($!day==10)checked#end	/>10天</label>
				</div>
			</div>
			#if($sample)
			<h3 class="divide">四、产品图片</h3>
			<div class="control-group" id="3F">
				<label class="control-label">
					#if($!{sample}&&${productsDO.productsTypeCode}=="10331000")
						<span class="red">*</span>
					#end
					产品图片：
				</label>
				<div class="controls clearfix">
					#foreach($pic in ${piclistl})
						<div class="upload-wrap">
							<img id="previewImg$!{velocityCount}" src="$!{address.thumb}$!{address.resource}/$!{pic.picAddress}" name="imag" width="75" height="75" border="1" />
							<br />
							<input type="button" value="重新上传" class="uploadBtn btn" id="uploadBtn_$!{velocityCount}" />
							<input type="hidden" value="$!{pic.id}" name="picIds" id="previewId$!{velocityCount}" />
							<input type="hidden" value="$!{pic.checkStatus}" name="picIdcs" id="previewCS$!{velocityCount}" />
						</div>
					#end
					#set($limit= 5 - ${piclistl.size()})
					#set($num=${piclistl.size()}+1)
					#if($limit > 0)
						#foreach($pic in [$num..5])
							<div class="upload-wrap">
								<img id="previewImg$pic" src="$!{address.images}/global/noimage.gif" name="imag" width="75" height="75" border="1" />
								<br />
								<input type="button" value="上传" class="uploadBtn btn" id="uploadBtn_$pic" />
								<input type="hidden" value="" name="picIds" id="previewId$pic" />
								<input type="hidden" value="2" name="picIdcs" id="previewCS$pic" />
							</div>
						#end
					#end
					<div class="error-wrap fl" id="picErrorContent" style="display:none;">
    					<span style="color:#B94A48">*请上传产品图片</span>
    				</div>
    				
    					#foreach($pic in ${piclistl})
    					#if($!{pic.checkStatus}==2)
			            <div style="color: red;font-weight: 700">
			            <br>
			            <br>
			            您的样品信息存在部分产品图片审核不通过。
			            <br>
			            <a href="#springUrl('/myproducts/office_img.htm?productsId=')$!{productsId}" style="color: #ff822e;font-weight: 700" >点击马上修改</a>
						</div>
						#break
						#end
					#end
    				
				</div>
			</div>
			<script type="text/javascript">
			jQuery(".uploadBtn").click(function(obj){
				var id = jQuery(this).attr("id").replace("uploadBtn_", "");
				var btn = jQuery(this);
				if (btn.val() == "上传") {
					Asto.util.Callback.setSubmitCallback(function (success, data) {
		   					 var ids=data.picId
							 var idArr=ids.split(",");
							 var paths=data.picAddress;
							 var pathArr=paths.split(",");
							 var t=0;
							 for(var i=1;i<idArr.length;i++){
								for(var j=1;j<=5;j++){
									var bt=jQuery("#uploadBtn_"+j);
									if(bt.val()=="上传"){
										t=j;
										break;
									}
								}
								if(t!=0){
									var url = "delayPicChange('" + t + "','" + pathArr[i] + "')";
									setTimeout(url, 2000);
									jQuery("#previewId" + t).val(idArr[i]);
									jQuery("#previewCS" + t).val("0");
									jQuery("#uploadBtn_"+t).val("重新上传");
								}
							}
							var num=Number(jQuery("#limitCount").val())-Number(idArr.length-1);
							jQuery("#limitCount").val(num);
							starCount();
							setTimeout(url, 2000);
							parent.closeoverlay();
					});
					var urls="$!{address.myrc}/photoabum/productsUpload.htm?destUrl=$!{address.myrc}/submitCallback.htm&albumId=3&productsId=$!{productsDO.id}&limitCount=";
					var url=urls+jQuery("#limitCount").val();
					//将弹框关闭等字显示出来
					parent.overtitle("上传图片");
					openoverlay(url,'上传图片',700,500,0);
				} else {
					deletePic(btn, id);
				}
			});
			function deletePic(btn, id) {
				jQuery.ajax({
					type: "post",
					async:false,
					url: "#springUrl('/myproducts/deleteOnlyPic.htm')",
					data: {
						"id": jQuery("#previewId" + id).val()
					},
					dataType: "json",
					success: function (req) {
						jQuery("#previewImg" + id).attr("src", "$!{address.img}/front/images/global/noimage.gif");
						jQuery("#previewId" + id).val("");
						jQuery("#previewCS" + id).val("2");
						btn.val("上传");
						var num=Number(jQuery("#limitCount").val())+Number(1);
						jQuery("#limitCount").val(num);
						starCount();
					},
					failure: function () {
						Asto.util.Message.show({
							msg: "发生错误，图片没有被删除，请过一会再试一下！",
							msgType: Asto.util.Message.ERROR,
							autoClose: 5000
						});
					}
				});
			}

			function delayPicChange(id,address){
				jQuery("#previewImg" + id).attr("src", "$!{address.resource}/"+address);
			}
				
            </script>
			#end
			
			<!-- part IV Start -->
			#parse("/commonImpt/products/companyAccount.vm")
			<!-- part IV End -->
			<div class="form-actions">
				<input type="submit" id="submitBtn" value="提 交" class="btn btn-primary">
			</div>
		
			<input type="hidden" name="spotId" value="$!{spot.spotId}" />
			<input type="hidden" name="detailsFlag" id="detailsFlag" value="0" />
			<input type="hidden" id="ckeditorFlag" value="0" />
			## 星级分数
			<input type="hidden" id ="score" name="score" value="" />
		</form>
	</div>
</div>
#parse("/common/importValidate.vm")

<script>

	jQuery(document).ready(function(){
	
		var typeCode = jQuery("#categoryProductsMainCode").val().substring(0, 4);
		if(typeCode === "1001"){
			jQuery("#useful_item").removeClass("hidden");
			jQuery("#color_item").removeClass("hidden");
			jQuery("#shape_item").removeClass("hidden");
			jQuery("#level_item").removeClass("hidden");
			jQuery("#appearance_item").removeClass("hidden");
			jQuery("#impurity_item").removeClass("hidden");
			jQuery("#grade_item").addClass("hidden");
			jQuery("#addProp_item").addClass("hidden");
		} else if (typeCode === "1000") {
			jQuery("#grade_item").removeClass("hidden");
			jQuery("#shape_item").removeClass("hidden");
			jQuery("#addProp_item").removeClass("hidden");
			jQuery("#useful_item").addClass("hidden");
			jQuery("#color_item").addClass("hidden");
			jQuery("#level_item").addClass("hidden");
			jQuery("#appearance_item").addClass("hidden");
			jQuery("#impurity_item").addClass("hidden");
		} else {
			jQuery("#useful_item").removeClass("hidden");
			jQuery("#impurity_item").removeClass("hidden");
			jQuery("#addProp_item").removeClass("hidden");
			jQuery("#grade_item").addClass("hidden");
			jQuery("#shape_item").addClass("hidden");
			jQuery("#color_item").addClass("hidden");
			jQuery("#level_item").addClass("hidden");
			jQuery("#appearance_item").addClass("hidden");
		}
		
		##地址显示
		if (jQuery("#location").val()) {
			jQuery("#address").removeClass("hidden")
		} else {
			jQuery("#setAddress").removeClass("hidden");
		}
		
		myrc.menu(2, 2);
		var category=new Asto.util.Selector({
			selects:["#c1","#c2","#c3","#c4"],
			assistSelects:["#ac"],
			url:"#springUrl('/category/productChild.htm')",
			assistUrl:"#springUrl('/category/productAssist.htm')",
			changeCallback:function(){
				if (jQuery("#categoryProductsMainCode").val()!= category.getValue()){
					jQuery("#categoryProductsMainCode").val(category.getValue());
					var typeCode = category.getValue().substring(0, 4);
            		if(typeCode === "1001"){
            			jQuery("#useful_item").removeClass("hidden");
            			jQuery("#color_item").removeClass("hidden");
            			jQuery("#shape_item").removeClass("hidden");
            			jQuery("#level_item").removeClass("hidden");
            			jQuery("#appearance_item").removeClass("hidden");
            			jQuery("#impurity_item").removeClass("hidden");
						jQuery("#grade_item").addClass("hidden");
            			jQuery("#addProp_item").addClass("hidden");
            		} else if (typeCode === "1000") {
            			jQuery("#grade_item").removeClass("hidden");
            			jQuery("#shape_item").removeClass("hidden");
            			jQuery("#addProp_item").removeClass("hidden");
						jQuery("#useful_item").addClass("hidden");
            			jQuery("#color_item").addClass("hidden");
            			jQuery("#level_item").addClass("hidden");
            			jQuery("#appearance_item").addClass("hidden");
            			jQuery("#impurity_item").addClass("hidden");
            		} else {
            			jQuery("#useful_item").removeClass("hidden");
            			jQuery("#impurity_item").removeClass("hidden");
            			jQuery("#addProp_item").removeClass("hidden");
						jQuery("#grade_item").addClass("hidden");
            			jQuery("#shape_item").addClass("hidden");
            			jQuery("#color_item").addClass("hidden");
            			jQuery("#level_item").addClass("hidden");
            			jQuery("#appearance_item").addClass("hidden");
            		}
				}
				
			}
		});
		
		#if($sample||$!{ypStatus}==1)
			jQuery("#c1").hide();
			jQuery("#c2").hide();
		#end

		category.init({
			initAssistCode:"$!{productsDO.categoryProductsAssistCode}",
			initCode:"$!{productsDO.categoryProductsMainCode}",
			rootCode:""
		});
		
		jQuery("#editForm").validationEngine("attach");
		jQuery("#editForm").submit(function() {
			var ut=1;
			var data=ckeditor.getData();
			jQuery("#content").val(data);
			var t=jQuery("#content").val();
			jQuery.ajax({
				type: "post",
				url: "#springUrl('/myproducts/detailsTip.htm')",
				data: {
					 "details": jQuery("#content").val()
				},
				dataType: "json",
				async:false,
				success: function (data) {
					if(!data.success){
						alert(data.data);
						ut=0;
						return false;
					}
				},
				failure: function () {
					ut=0;
					return false;
				}
			});
			if(ut==1){
				var $property = $("input[name=property]");
				var flg1 = 1;
				for(var i=0;i<$property.length;i++){
			
	    			if ($property.eq(i).val()==="属性") {
						flg1 += 1;
						if (flg1 > "2") {
							$property.eq(i).parent().parent().find(".tag").html("*属性名不能为空!");
							$property.eq(i).css("border-color","#b94a48");		
						} 
					}
				}
				var $content = $("input[name=content]");
				var flg2 = 1;
				for(var i=0;i<$content.length;i++){
	    			if ($content.eq(i).val()==="属性值") {
						flg2 += 1;
						if (flg2 >= "2") {
							if ($content.eq(i).parent().parent().find(".tag").html() === "*属性名不能为空!") {
								$content.eq(i).parent().parent().find(".tag").html("*属性名和属性值都不能为空!");
								$content.eq(i).parent().parent().find("input[name=property]").css("border-color","#b94a48");
							} else{
								$content.eq(i).parent().parent().find(".tag").html("*属性值不能为空!");
							}
							$content.eq(i).css("border-color","#b94a48");		
						} 
					}
				}
				for(var i=0;i<$property.length;i++){
					if ($property.eq(i).parent().parent().find(".tag").html() != ""){
						return false;
					}
				}
				## 样品信息 检验是否有上传图片
   				#if(($!{sample}||$!{ypStatus})&&${productsDO.productsTypeCode}=="10331000"&&$!{piclist.size()}<1)
        			for(var i=0;i<5;i++){
        				if(jQuery("#previewId"+i).val()!=null&&jQuery("#previewId"+i).val()!=""){
        					break;
        				}
        				if(i==4){
        					jQuery("#previewId1").focus();
        					jQuery("#picErrorContent").show();
        					return false;
        				}
        			}
    			#end
			}else{ 
				return false;
			}
        });
		
		
		## 公开价格 填写价格
		jQuery(".opPrice").click(function(){
			var s = jQuery(":input[name='opPrice'][checked]").val();
			if(s == 1){
				jQuery(".validatePrice").hide();
				jQuery("#minPrice").val("");
				jQuery("#minPrice").validationEngine("hide");
			} else {
				jQuery(".validatePrice").show();
				jQuery("#minPrice").val("$!{productsDO.minPrice}");
			}
		});
		## 隐藏价格
		#if(!$!{productsDO.minPrice}||$!{productsDO.minPrice}=="0.0")
			jQuery(".validatePrice").hide();
		#end


		## 现货切换
		jQuery(":input[name='goodsTypeCode']").change(function(){
					var code = jQuery(":input[name='goodsTypeCode'][checked]").val();
					if(code === "10361001") {
						jQuery(".J_spotProp").removeClass("hidden")
					} else {
						jQuery(".J_spotProp").addClass("hidden")
					}
				});
	});
	
	function ortherInput(id, value) {
        jQuery("#" + id).val(value);
    }
	
	## 判断最大价格
	function checkMaxPrice(field, rules, i, options){
		var min = parseInt(jQuery("#minPrice").val());
		var max = parseInt(jQuery("#maxPrice").val());
		if(min>0&&max>0&&min<max){
			##jQuery("#maxError").hide();
		}else{
			##jQuery("#maxError").html("<span>* 必须大于最小价格： "+min+"</span>")
			##jQuery("#maxError").show();
			##var str = "<span>* 必须大于最小价格： "+min+"</span>"
			##jQuery(".maxPriceformError").html("<div class='formErrorContent'><span>"+str+"</span></div>");
			rules.push('required');
			return "价格范围填写不正确";
		}
	}
	
	##删除增加属性
	function deleteProperty(propertyId,div) {
		 var id = jQuery("#id").val();
		 var property = encodeURI(jQuery("#"+propertyId).val());
	     jQuery.ajax({
		    type:"post",
			url:encodeURI("/myproducts/updateIsDel.htm?productId="+id+"&property=" +property),
			dataType:"json",
			cache:false,
			success:function(data){
				jQuery("#"+div).remove();
		     }
    	});
		
	}
	
	function upload(){
		jQuery("#detailsFlag").val("0");
		var htmlImg = ckeditor.getData();
		var imgAll=htmlImg.split("<img")
		if(imgAll.length<6){
			Asto.util.Callback.setSubmitCallback(function (success, data) {
				var paths=data.picAddress;
				var pathArr=paths.split(",");
				var t=0;
				for(var i=1;i<pathArr.length;i++){
					var img="<img src=\"$!{address.img3}/"+pathArr[i]+"\"/>";
					if(jQuery("#ckeditorFlag").val()==0){
					
						var html = ckeditor.getData();
						
						if(!+[1,]){
							jQuery("#content").val(html+img)
						}else{
							ckeditor.document.getBody().setHtml(html+img);	
						}
					}else{
						ckeditor.insertHtml(img);
					}
				}	
					var num=Number(jQuery("#textPhoto").val())-Number(pathArr.length-1);
					jQuery("#textPhoto").val(num);
					jQuery("#detailsFlag").val("1");
					setTimeout(url, 2000);
					parent.closeoverlay();
					starCount();
			});
			var limitCount=Number(5)-Number(imgAll.length)+Number(1);
			var urls="$!{address.myrc}/photoabum/productsUpload.htm?destUrl=$!{address.myrc}/submitCallback.htm&albumId=3&contextFlag=1&limitCount=";
			var url=urls+limitCount;
			//将弹框关闭等字显示出来
			parent.overtitle("上传图片");
			openoverlay(url,'上传图片',700,500,0);
		}
	};
	## 修改详细 标记
	jQuery("#details").change(function(){
		jQuery("#detailsFlag").val("1");
	});
	
	jQuery("input[name='priceUnit']").on("change", function () {
		if (this.getAttribute("id") === "myPriceUnit") {
			jQuery('#otherQuantityPrice').removeClass("hidden");
			jQuery("#office_post_edit").focus();
		} else {
			jQuery('#otherQuantityPrice').addClass("hidden");
			jQuery(this).parent().parent().parent().parent().removeClass("error");
		}
	});
	jQuery("#otherUnit").on({
		"blur": function () {
				if (this.value === "") {
					this.value = "元";
					jQuery(this).parent().parent().parent().addClass("error");
				} else {
					jQuery(this).parent().parent().parent().removeClass("error");
				}
				ortherInput('myPriceUnit', this.value);
			},
			"click": function () {
				jQuery('#myPriceUnit').attr('checked', true);
			}
	});
	
	##组装供求详细

    function appendDetail() {
    	var detailStr = jQuery("#title").val();
    	var quantity = jQuery("#quantity").val();
    	if (quantity) {
    		detailStr += "；$!{typename}数量" + quantity + jQuery(":input[name='quantityUnit'][checked]").val() + "左右";
    	}
    	var minPrice = jQuery("#minPrice").val();
    	if (minPrice) {
    		detailStr += "；大概报价" + minPrice;
    		var maxPrice = jQuery("#maxPrice").val();
    		if (maxPrice) {
    			detailStr += " - " + maxPrice;
    		}
    		detailStr += jQuery(":input[name='priceUnit'][checked]").val() + "/" + jQuery(":input[name='quantityUnit'][checked]").val();
    	} else {
    		detailStr += "；价格面议"
    	}
    	var source = jQuery("#source").val();
    	if (source) {
    		detailStr += "；现在货在" + source;
    	}
    	var shipDay = jQuery("#shipDay").val();
    	if (shipDay) {
    		detailStr += "；大概" + shipDay + "天内可以发货";
    	}
    	detailStr += "。";
    	var data=ckeditor.getData();
		if(!+[1,]){
			jQuery("#content").val(detailStr+data)
		}else{
        	ckeditor.document.getBody().setHtml(detailStr+data);
		}
		
    }
	
	$(function(){
    	$(".container").Sonline({
    		Position:"right",//left或right
    		Top:200,//顶部距离，默认200px
    		Effect:true, //滚动或者固定两种方式，布尔值：true或false
    		DefaultsOpen:true, //默认展开：true,默认收缩：false隔开
    		Qqlist:""
    	});
    })
    
    function bookmarks(obj) {
        var obj1 = $(obj).attr("action-data");
        var zuobiao = $("#" + obj1).offset().top - 60;
        $('body,html').animate({
            scrollTop: zuobiao + 'px'
        },
        "slow")
    }
	
	$(function(){
		//$('#editForm :input')获取的不仅有input[text]，还有最后的那个radio, raido默认的值为第一个option的值，
		//所以打开这个页面就最后一栏"radio"是默认有值状态
		$('#editForm :input').blur(function(){
			starCount();
		})
		
		$('#editForm :input').click(function(){
			starCount();
		})
		
		starCount();
		#if(!$ps)
			jQuery.ajax({
				url:"#springUrl('/myproducts/countScoreForInitProducts.htm')",
				data:{"score":jQuery("#score").val(),"productsId":$!{productsDO.id}}
			});
		#end
	})
	
    function countScore(str,score){
    	if(str!=""&&str!=undefined){
    		return score;
    	}
    	return 0;
    }
	
	##点亮
	function lightF(i){
		$(".tab-list a[action-data="+i+"F] span").css("color","#009944");
        $(".tab-list a[action-data="+i+"F] i").removeClass("gtick");
        $(".tab-list a[action-data="+i+"F] i").addClass("tick");
	}
	##点暗
	function greyF(i){
		$(".tab-list a[action-data="+i+"F] span").css("color","#9a9a9a");
		$(".tab-list a[action-data="+i+"F] i").removeClass("tick");
		$(".tab-list a[action-data="+i+"F] i").addClass("gtick");
	}

    function starCount(){
    	## 总分值
    	var cmpltnum = 0;
    	
    	## 完善交易条件点亮条件：必填产品名称、产品标签、供应数量、报价（需要填写价格，选择电议或者面议不加分且不点亮）
    	var title  		= $("#title").val();  										## 标题 5分
    	var tags 		= $("#tags").val(); 										## 标签 5分
    	var quantity 	= $("#quantity").val();										## 数量 5分
    	var minPrice 	= $("#minPrice").val();										## 报价 5分
    	## 判断点亮
    	if(title == "" || tags == "" || quantity == "" || minPrice == "" ){
    		$(".tab-list a[action-data=1F] span").css("color","#9a9a9a");
    		$(".tab-list a[action-data=1F] i").removeClass("tick");
    		$(".tab-list a[action-data=1F] i").addClass("gtick");
    	}else{
            $(".tab-list a[action-data=1F] span").css("color","#009944");
    		$(".tab-list a[action-data=1F] i").removeClass("gtick");
    		$(".tab-list a[action-data=1F] i").addClass("tick");
    	}
    	## 计算分值
    	cmpltnum = cmpltnum + countScore(title,5);
    	cmpltnum = cmpltnum + countScore(tags,5);
    	cmpltnum = cmpltnum + countScore(quantity,5);
    	cmpltnum = cmpltnum + countScore(minPrice,5);
    
		## 通用属性分值计算
		## 货源地 3分
    	var $source 	= $("#source").val();
		## 来源产品 3分
    	var $origin 	= $("#origin").val();
		## 产品规格 3分
    	var $specification = $("#specification").val();
		## 加工说明 3分
    	var manufacture = $("input[name='manufacture']:checked").val();
		cmpltnum = cmpltnum + countScore($source,3);
        cmpltnum = cmpltnum + countScore($origin,3);
        cmpltnum = cmpltnum + countScore($specification,3);
        cmpltnum = cmpltnum + countScore(manufacture,3);
		
		var typeCode = jQuery("#categoryProductsMainCode").val().substring(0, 4);
    	if (typeCode === "1001") {
			## 塑料分值计算
        	## 颜色 3分
        	var $color 		= $("#color").val();
        	## 形态 3分
        	var $shape 		= $("#shape").val();
        	## 级别 3分
        	var $level 		= $("#level").val();
        	## 外观 3分
        	var $appearance = $("#appearance").val();
        	## 此原料可用于 3分
        	var $useful 	= $("#useful").val();
        	## 杂质(杂物)含量 3分
        	var $impurity 	= $("#impurity").val();
			
			## 判断变色
        	if($color == "" || $shape == "" || $level == "" || $appearance == "" || $source == "" || $origin == "" || $specification == "" || $useful == "" || $impurity == ""|| manufacture == undefined){
				greyF(2);
        	}else{
				lightF(2);
        	}
    
    		## 计算分值
        	cmpltnum = cmpltnum + countScore($color,3);
        	cmpltnum = cmpltnum + countScore($shape,3);
        	cmpltnum = cmpltnum + countScore($level,3);
        	cmpltnum = cmpltnum + countScore($appearance,3);
        	cmpltnum = cmpltnum + countScore($useful,3);
        	cmpltnum = cmpltnum + countScore($impurity,3);
    	} else if (typeCode === "1000") {
			## 金属分值计算
			## 品位 3分
        	var grade = $("#grade").val();
			## 形态 3分
        	var $shape 		= $("#shape").val();
			
			## 判断变色
			if(grade == "" || $shape == "" || $source == "" || $origin == "" || $specification == "" || manufacture == undefined){
				greyF(2);
			}else{
				lightF(2);
			}
			
			## 计算分值
			cmpltnum = cmpltnum + countScore(grade,3);
			cmpltnum = cmpltnum + countScore($shape,3);
			
			## 附加属性分值计算
			var proScore = 0;
			jQuery("input[name='content']").each(function(){
				var proStr = jQuery(this).val();
				if(proStr!="属性值"&&proStr!=""){
					proScore = proScore + 3;
				}
			});
			if(proScore>12){
				proScore=12;
			}
			cmpltnum = cmpltnum + proScore;
			
    	} else {
			## 其他废料分值计算
			## 此原料可用于 3分
        	var $useful 	= $("#useful").val();
			## 杂质(杂物)含量 3分
        	var $impurity 	= $("#impurity").val();
			
			## 判断变色
        	if($source == "" || $origin == "" || $specification == "" || $useful == "" || $impurity == ""|| manufacture == undefined){
				greyF(2);
        	}else{
				lightF(2);
        	}
			
			## 计算分值
			cmpltnum = cmpltnum + countScore($useful,3);
        	cmpltnum = cmpltnum + countScore($impurity,3);
			
			## 附加属性分值计算
			var proScore = 0;
			jQuery("input[name='content']").each(function(){
				var proStr = jQuery(this).val();
				if(proStr!="属性值"&&proStr!=""){
					proScore = proScore + 3;
				}
			});
			if(proScore>12){
				proScore=12;
			}
			cmpltnum = cmpltnum + proScore;
    	}
		
		## 交易条件非必填 全填才有五分
		##交易说明
		var transaction = $("input[name='transaction']:checked").val();
		##发货时间
		var shipDay = jQuery("#shipDay").val();
		##现货所在地
		var location = jQuery("#location").val();
		
		if(jQuery("#transactionValue").is(':checked')){
    		var transactionArea = jQuery("#transactionArea").val();
			if(transactionArea !="" && shipDay !="" && location !=""){
				cmpltnum = cmpltnum + 5;
			}
		}else{
			if(transaction !=undefined && shipDay !="" && location !=""){
				cmpltnum = cmpltnum + 5;
			}
		}
		
		## 检查是否有图片
		#if($sample)
			var pics = 0
    		jQuery("input[name='picIdcs']").each(function(){
        		if(jQuery(this).val()!=2){
        			cmpltnum = cmpltnum + 5;
					pics = pics +1 ;

        		}
				if(pics==0){
					greyF(3);
				}else{
					lightF(3);
				}
        	});
		#else
    		#if($!{piclist.size()}>0)
        		cmpltnum = cmpltnum + $!{piclist.size()} * 5;
    			$(".tab-list a[action-data=3F] span").css("color","#009944");
        		$(".tab-list a[action-data=3F] i").removeClass("gtick");
        		$(".tab-list a[action-data=3F] i").addClass("tick");
    		#end
		#end
		
    
    	## 信息描述完整度 变色
    	var details=ckeditor.getData();
    	if(details == ""){
    		$(".tab-list a[action-data=4F] span").css("color","#9a9a9a");
    		$(".tab-list a[action-data=4F] i").removeClass("tick");
    		$(".tab-list a[action-data=4F] i").addClass("gtick");
    	}else{
			jQuery.ajax({
				url:"#springUrl('/myproducts/validteDetailsScore.htm')",
				data:{str:details},
				async:false,
				type:"POST",
				dataType:"json",
				success:function(data){
					cmpltnum = cmpltnum + data.score;
					if(data.cnLength>=30){
						lightF(4);
					}else{
						greyF(4);
					}
				}
			})
    	}
    	
    	var cmprate = cmpltnum;
    	$('#num').html(''+cmpltnum);
    	if(cmprate >= 0 && cmprate < 10){
    		$('#cmpltlvl').attr('class', 'lv0');
    	}else if(cmprate >= 10 && cmprate < 20){
    		$('#cmpltlvl').attr('class', 'lv0');
    	}else if(cmprate >= 20 && cmprate < 30){
    		$('#cmpltlvl').attr('class', 'lv1');
    	}else if(cmprate >= 30 && cmprate < 40){
    		$('#cmpltlvl').attr('class', 'lv1');
    	}else if(cmprate >= 40 && cmprate < 50){
    		$('#cmpltlvl').attr('class', 'lv2');
    	}else if(cmprate >= 50 && cmprate < 60){
    		$('#cmpltlvl').attr('class', 'lv2');
    	}else if(cmprate >= 60 && cmprate < 70){
    		$('#cmpltlvl').attr('class', 'lv3');
    	}else if(cmprate >= 70 && cmprate < 80){
    		$('#cmpltlvl').attr('class', 'lv3');
    	}else if(cmprate >= 80 && cmprate < 90){
    		$('#cmpltlvl').attr('class', 'lv4');
    	}else if(cmprate >= 90 && cmprate < 100){
    		$('#cmpltlvl').attr('class', 'lv4');
    	}else if(cmprate >= 100){
    		$('#cmpltlvl').attr('class', 'lv5');
    	}
		
		jQuery("#score").val(cmpltnum);
		
    }
	
  
</script>
