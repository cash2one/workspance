<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="phone">
	<typeAlias alias="phoneDO" type="com.ast.ast1949.domain.phone.Phone" />
	<resultMap class="phoneDO" id="phoneResult">
		<result property="id" column="id" />
		<result property="companyId" column="company_id" />
		<result property="account" column="account" />
		<result property="tel" column="tel" />
		<result property="keywords" column="keywords" />
		<result property="customerId" column="customer_id" />
		<result property="accessToken" column="access_token" />
		<result property="amount" column="amount" />
		<result property="balance" column="balance" />
		<result property="gmtOpen" column="gmt_open" />
		<result property="gmtCreated" column="gmt_created" />
		<result property="gmtModified" column="gmt_modified" />
		<result property="frontTel" column="front_tel" />
	</resultMap>

	<sql id="defaultColumn">
		id,
		company_id,
		account,
		tel,
		keywords,
		customer_id,
		access_token,
		amount,
		balance,
		gmt_open,
		gmt_created,
		gmt_modified,
		front_tel
	</sql>

	<select id="queryById" parameterClass="java.lang.Integer"
		resultMap="phoneResult">
		SELECT
		<include refid="defaultColumn" />
		FROM phone
		where id = #id#
	</select>

	<insert id="insert" parameterClass="phoneDO">
		INSERT INTO phone
		(
		company_id,
		account,
		tel,
		front_tel,
		keywords,
		customer_id,
		access_token,
		amount,
		balance,
		gmt_open,
		gmt_created,
		gmt_modified)
		VALUES
		(
		#companyId#,
		#account#,
		#tel#,
		#frontTel#,
		#keywords#,
		#customerId#,
		#accessToken#,
		#amount#,
		#balance#,
		now(),
		now(),
		now())
		<selectKey keyProperty="id" resultClass="java.lang.Integer" >
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>

	<update id="update" parameterClass="phoneDO">
		UPDATE phone
		SET
		gmt_modified = now()
		<isNotNull prepend="," property="companyId">
			company_id = #companyId#
		</isNotNull>
		<isNotEmpty prepend="," property="account">
			account = #account#
		</isNotEmpty>
		<isNotEmpty prepend="," property="tel">
			tel = #tel#
		</isNotEmpty>
		<isNotEmpty prepend="," property="frontTel">
			front_tel = #frontTel#
		</isNotEmpty>
		<isNotEmpty prepend="," property="keywords">
			keywords = #keywords#
		</isNotEmpty>
		WHERE id = #id#
	</update>
	
	<update id="updateAmountAndBalance" parameterClass="java.util.Map">
		UPDATE phone
		SET
		gmt_modified = now()
		<isNotEmpty prepend="," property="amount">
			amount = #amount#
		</isNotEmpty>
		<isNotEmpty prepend="," property="balance">
			balance = #balance#
		</isNotEmpty>
		WHERE id = #id#
	</update>

	<sql id="whereClause">
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="phone.keywords">
				keywords =
				#phone.keywords#
			</isNotEmpty>
		</dynamic>
	</sql>

	<select id="queryList" parameterClass="java.util.Map" resultMap="phoneResult">
		SELECT
		<include refid="defaultColumn" />
		FROM phone
		<include refid="whereClause" />
		<include refid="common.pageOrderBy" />
		<include refid="common.pageLimit" />
	</select>

	<select id="queryListCount" parameterClass="java.util.Map"
		resultClass="java.lang.Integer">
		SELECT count(0)
		FROM phone
		<include refid="whereClause" />
	</select>

	<select id="countByAccount" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		select count(0)
		from phone
		where account = #account#
	</select>
	
	<select id="countByCompanyId" parameterClass="java.lang.Integer" resultClass="java.lang.Integer">
		select count(0)
		from phone
		where company_id = #companyId#
	</select>
	
	<delete id="deleteById" parameterClass="java.lang.Integer">
		delete from phone
		where id = #id#
	</delete>
	
	<select id="queryByCompanyId" parameterClass="java.lang.Integer" resultMap="phoneResult">
		select 
		<include refid="defaultColumn" />
		FROM phone
		where company_id = #companyId#
		limit 1
	</select>
	
	<select id="queryByTel" parameterClass="java.lang.String" resultMap="phoneResult">
		select 
		<include refid="defaultColumn" />
		FROM phone
		where tel = #tel#
		limit 1
	</select>
	

</sqlMap>