<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>互助社区发布</title>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
		<style>
			body {
				background: #f4f4f4;
				width: 100%;
				height: 100%;
				font-size:14px;
				padding-top: 15px;
			}
			/*.buy-box{
			 padding: 10px 8px;
			 background-color: #f2f2f2;
			 }
			 .buy-box:after{
			 border-top: none;
			 }
			 .aui-input-row:before{
			 border-top: none !important;
			 }*/
			.buy-show-box {
				display: block;
				background-color: #f2f2f2;
			}
			p.title {
				margin: 10px 0;
			}
			textarea.buy-show {
				width: 100%;
				border: none;
				height: 100px;
				font-size: 14px;
				margin-bottom: 0;
			}
			.handle {
				padding: 30px 8px 0px;
			}
			.handle-add {
				border: 1px dashed #e1e1e1;
				width: 23px;
				height: 23px;
				background: url(../../image/imageslist.png);
				background-size: 320px;
				background-position: -110px -234px;
			}
			.handle-add {
				border: 1px dashed #e1e1e1;
				width: 80px;
				height: 80px;
				text-align: center;
				line-height: 80px;
				background: #f2f2f2;
				float: left;
				margin: 0 20px 20px 0;
			}
			.img-kuang {
				position: relative;
				margin: 0 20px 20px 0;
				float: left;
				border: 1px dashed #e1e1e1;
				width: 80px;
				height: 80px;
			}
			.aui-icon-move {
				text-align: center;
				line-height: 20px;
				color: #fff
			}
			.delt-img {
				position: absolute;
				height: 20px;
				width: 20px;
				right: -10px;
				top: -10px;
				background: red;
				border-radius: 12px;
				box-shadow: 0px 0px 2px red;
			}
			.handle-add .aui-icon-add {
				font-size: 43px;
			}
			.handle-into {
				display: block;
				width: 100%;
				height: 40px;
				background-color: #01ba2e;
				color: #ffffff;
				position: relative;
				position: fixed;
				bottom: 0;
				text-align: center;
				padding-top: 8px;
			}
			.handle-into i {
				position: absolute;
				height: 20px;
				width: 20px;
				background: url(../../image/imageslist.png);
				background-size: 320px;
				background-position: -110px -214px;
				left: 50%;
				margin-left: -40px;
			}
		</style>
	</head>
	<body>
		<section class="aui-card">
			<div class="aui-input-row" style="font-size:14px">
                <span class="aui-input-addon"></span>
                <div class="aui-pull-left type-into">
                    <input class="aui-radio aui-radio-warning" type="radio" name="Fruit" value="1" checked> <span class="aui-radio-name">互助问答</span>
                    <input class="aui-radio aui-radio-warning" type="radio" name="Fruit" value="2"> <span class="aui-radio-name">互助社区</span>
                    <input class="aui-radio aui-radio-warning" type="radio" name="Fruit" value="2"> <span class="aui-radio-name">互助社区</span>
                </div>
            </div>
			<div class="buy-box aui-form">
				<div class="aui-input-row">
					<label class="aui-input-addon">标题</label>
					<input type="text" class="aui-input" placeholder="请输入标题！" />
				</div>
			</div>
			<p class="aui-text-center title">
				详细描述
			</p>
			<div class="aui-line-x"></div>
			<div class="aui-form">
				<textarea placeholder="详细的描述问题有助于帮主有的放矢！" class="buy-show"></textarea>
			</div>
			<div class="handle">
				<span class="handle-add"> <i class="aui-iconfont aui-icon-add"></i> </span>
			</div>
			<div style="clear:both"></div>
		</section>
		
		
		<section class="aui-content-padded">
			<div class="aui-btn aui-btn-block aui-btn-info" style="background-color:#01ba2e;border:none">
				提交问题
			</div>
		</section>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/jquery.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/common.js"></script>
	<script type="text/javascript">
		apiready = function() {
			//删除添加的图片
			$(".handle").on("click", ".aui-icon-move", function() {
				$(this).parent().fadeOut(function() {
					$(this).remove();
				})
			})
			//浏览图片
			var imagesList = [];
			$(".handle").on("click", "img", function() {
				// imagesList =["widget://image/demo1.png","widget://image/demo1.png"];
				var photoBrowser = api.require('photoBrowser');
				photoBrowser.open({
					images : imagesList,
					activeIndex : 0,
					bgColor : '#000'
				}, function(ret) {
					alert(JSON.stringify(ret));
				});
			})
			//添加图片
			$(".handle-add").on("click", function() {
				var thisBtn = $(this);
				var UIMediaScanner = api.require('UIMediaScanner');
				UIMediaScanner.open({
					type : 'picture',
					max : 5,
					texts : {
						stateText : '图片选择', //（可选项）字符串类型；状态文字内容；*号会被替换为已选择个数；默认：'已选择*项'
						cancelText : '取消', //（可选项）字符串类型；取消按钮文字内容；默认：'取消'
						finishText : '完成'
					},
					styles : {
						bg : '#fff',
						mark : {
							icon : '',
							position : 'bottom_left',
							size : 20
						},
						nav : {
							bg : '#eee',
							stateColor : '#000',
							stateSize : 18,
							cancelBg : 'rgba(0,0,0,0)',
							cancelColor : '#000',
							cancelSize : 18,
							finishBg : 'rgba(0,0,0,0)',
							finishColor : '#000',
							finishSize : 18
						}
					},
					scrollToBottom : {
						intervalTime : -1,
						anim : true
					},
					exchange : true
				}, function(ret, err) {
					if (ret) {
						var imginfo = "";
						$.each(ret.list, function(i, item) {
							imagesList.push(item.path)
							imginfo += '<span class="img-kuang">' + '<img src="' + item.path + '" width="100%" height="100%">' + '<i class="delt-img aui-iconfont aui-icon-move"></i>' + '</span>'
						});
						thisBtn.before(imginfo)
					} else {
						alert(JSON.stringify(err));
					}
				})
			})
			$(".handle-into").on("click", function() {
				var title = $(".title-input input").val();
				var content = $(".text-area textarea").val()
				if (title == "") {
					hint("您的标题还没填写！");
					return;
				}
				if (content == "") {
					hint("您的回复内容还没填写！");
					return;
				}
				var data = {
					company_id : UserInfo.memberID(),
					usertoken : UserInfo.token(),
					appsystem : api.systemType,
					datatype : "json",
					title : title,
					category_id : $(".type-into input:checkbox").val(),
					content : content
				}
				api.ajax({
					url : hosturl + 'huzhupostsave/',
					method : 'post',
					timeout : 30,
					dataType : 'json',
					returnAll : false,
					data : {
						values : data
					}
				}, function(ret, err) {
					if (ret) {
						if (ret.err == "false") {
							api.alert({
								title : '互助发布',
								msg : "发布成功",
								buttons : ['确定']
							}, function(ret, err) {
							})
						} else {
							api.alert({
								title : '互助发布',
								msg : ret.errkey,
								buttons : ['确定']
							}, function(ret, err) {
							})
						}
					} else {
					};
				});
			})
		}
		function hint(ts) {
			$(".hint").remove()
			var hintHtml = '<div class="hint" style="position:fixed;color:#fff;line-height:18px;font-size:14px;width:100%">' + '<span style="display:block;margin:0 8px;background:#000;opacity:0.8;border-radius:5px;padding:10px 10px;text-align:center">' + ts + '<span>' + '</div>';
			$("body").append(hintHtml);
			var hint_height = $(".hint").height();
			var wd_height = $(window).height();
			var top_height = (wd_height - hint_height) / 2
			$(".hint").css("top", top_height + "px");
			setTimeout(function() {
				$(".hint").fadeOut("slow", function() {
					$(".hint").remove()
				})
			}, 2000)
		}
	</script>
</html>