<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=2,user-scalable=no">
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="telephone=no" name="format-detection" />
		<meta content="email=no" name="format-detection" />
		<meta content="black" name="apple-mobile-web-app-status-bar-style">
		<title>废料产业带</title>
		<link href="../../css/ye/industrial.m.css" rel="stylesheet" type="text/css" />
	</head>
	<body>
		<div id="deal" style="display:none">
			<div class="list">
				<div class="album fix" style="height:200px">
				</div>
				<div class="yedetails"></div>
				<script id="yelist" type="text/html">
				<dl class="list" id="deal-terms">
					<dd style="border: 0;">
						<dl class="first" style="/*margin-top: 160px;*/border-bottom:none">
							<dt >
								市场简介
							</dt>
							<dd class="dd-padding">
								<p class="lh">
									{{d.introduction}}
								</p>
							</dd>
						</dl>
					</dd>
					<dd>
						<dl>
							<dt>
								市场概况
							</dt>
							<dd class="dd-padding">
								<ul>
									<li id="ok"></li>
									<li>
										<p class="lh">
											所属行业：{{d.industry}}
										</p>
									</li>
									<li>
										<p class="lh">
											所在地区：{{d.area}}
										</p>
									</li>
									<li>
										<p class="lh">
											主营范围：{{d.business}}
										</p>
									</li>
									<li>
										<p class="lh">
											市场商户：<font class="red">{{d.company_num}}</font>家
										</p>
									</li>
									<li>
										<p class="lh">
											市场供求：<font class="red">{{d.product_num}}</font>条
										</p>
									</li>
									<li class="joinmarket">
										<div class="btn-wrapper">
											<a onclick="join_ajax('{{d.industry}}','{{d.area}}','{{d.id}}')" class="btn buy-btn btn-block btn-larger btn-strong" href="javascript:void(0);" rel="nofollow">我是该市场商户,我要加入</a>
										</div>
									</li>
								</ul>
							</dd>
						</dl>
					</dd>
				</dl>
				</script>
				<dl class="list">
					<div class="title-in">
						<ul class="taba taban" id="nav">
							<li name="n1" class="on">
								<a class="react" href="javascript:;">市场供求</a>
							</li>
							<li name="n2">
								<a class="react" href="javascript:;">市场商户</a>
							</li>
						</ul>
					</div>
					<div class="container-in">
						<div id="deals">
							<dd>
								<dl class="list" id="n1">
									<span class="productslist"></span>
									<script id="productslist" type="text/html">
									<dd>
										<a id="{{d.pdt_id}}" target="_blank" class="react">
										<div class="dealcard">
											<div class="dealcard-img imgbox" data-src="">
												<img src="{{d.pdt_images}}" />
											</div>
											<div class="dealcard-right">
												<div class="dealcard-brand oow">
													{{d.pdt_kind.kindtxt}}{{d.pdt_name}}<font class="time">{{d.pdt_time_en}}</font>
												</div>
												<div class="title text-block">
													{{d.com_province}}
												</div>
												<div>
													{{d.pdt_price}}
												</div>
											</div>
										</div> </a>
									</dd>
									</script>
									<dd style="line-height: 30px;margin-bottom: 20px;">
										<a href="/ye/pro{{ye_detaillist.id}}.html">查看更多>></a>
									</dd>
								</dl>
								<dl class="list" id="n2" style="display:none;">
									<span class="companylist"></span>
									<script id="companylist" type="text/html">
									<dd>
										<a id="{{d.company_id}}" target="_blank">
										<div class="dealcard">
											<div class="dealcard-left" style="height: auto;margin-top: 10px;">
												<div class="dealcard-brand oow">
													{{d.name}}
												</div>
												<div class="title text-block">
													{{d.business}}
												</div>
											</div>
										</div> </a>
									</dd>
									</script>
									<dd style="line-height: 30px;margin-bottom: 20px;">
										<a href="/ye/comp{{ye_detaillist.id}}.html">查看更多>></a>
									</dd>
								</dl>
							</dd>
						</div>
					</div>
				</dl>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/common.js"></script>
	<script type="text/javascript" src="../../script/laytpl.js"></script>
	<script src="../../script/ye/industrial.m.js"></script>
	<script src="../../script/ye/touchslider_min.js"></script>
	<script type="text/javascript">
		var nowurl, searchdata,tourl;
		apiready = function() {
			tourl = api.pageParam.tourl;
			nowurl = tourl;
			api.showProgress({
				title : '加载中',
				modal : false
			});
			searchdata['company_id']=UserInfo.memberID();
			searchdata['usertoken']=UserInfo.token();
			searchdata['appsystem']=api.systemType;
			ajaxInfo();
		}
		var dataload = true;
		var loadnum = 1;
		var picpath=[];
		var piccaptions=[];
		function ajaxInfo() {
			if (dataload == false) {
				return;
			}
			dataload = false;
			api.ajax({
				url : hosturl + nowurl + '?datatype=json',
				method : 'get',
				timeout : 30,
				dataType : 'json',
				returnAll : false,
				data : {
					values : searchdata
				}
			}, function(ret, err) {
				if (ret) {
					loadnum = 1;
					//头部图片
					var piclist = ret.piclist;
					$.each(piclist, function(index, item) {
						picpath.push(item.pic_address);
						piccaptions.push(ret.detail.name)
					});
					//基本信息
					var getTpl = $api.html($api.byId("yelist"));
					laytpl(getTpl).render(ret.detail, function(html) {
						$(".yedetails").html(html);
					});
					//供求信息
					var pageHtml="";
					$.each(ret.productlist, function(index, item) {
						var getTpl = $api.html($api.byId("productslist"));
						laytpl(getTpl).render(item, function(html) {
							pageHtml = pageHtml + html;
						});
					})
					$(".productslist").html(pageHtml);
					//供求信息
					var pageHtml="";
					$.each(ret.companylist, function(index, item) {
						var getTpl = $api.html($api.byId("companylist"));
						laytpl(getTpl).render(item, function(html) {
							pageHtml = pageHtml + html;
						});
					})
					$(".companylist").html(pageHtml);
					//alert(JSON.stringify(picpath))
					showscrollpic();
					api.pageUp({
						'top' : true
					});
					api.refreshHeaderLoadDone();
					api.hideProgress();
					$("#deal").show();
					//打开供求
					$(".productslist").on("click", "a", function() {
						var id = $(this).attr("id");
						var pageParam = {
							wintitle : "供求详情",
							type : "infomation-heart",
							id : id,
							nav_list : [{
								"typename" : "供求详情",
								"id" : 1
							}, {
								"typename" : "公司简介",
								"id" : 2
							}], //头部划动标题
							frame_url : ["../trade/firm-detail.html", "../trade/firm.html"], //打开frame组的页面集合
							topnumber : 2,
							bounces : false
						};
						openWin("infomation-heart", "infomation-heart.html", pageParam);
					})
					//打开公司
					$(".companylist").on("click","a",function(){
			            var id = $(this).attr("id")
			            var pageParam = {
			                wintitle:"公司详情",
			                type:"firm",
			                id:id,
			                topnumber:2,
			                bounces:false
			            };
			            openWin("firm","../trade/firm.html",pageParam);
			        });
				} else {
					//出错重试3次
					if (loadnum <= 3) {
						ajaxInfo();
					} else {
						api.toast({
						    msg: '系统错误，请重试！',
						    duration: 2000,
						    location: 'bottom'
						});
					}
				}
				loadnum = loadnum + 1;
				dataload = true;
			})
		}
		//顶部滚动图片
		function showscrollpic() {
			var UIScrollPicture = api.require('UIScrollPicture');
			UIScrollPicture.open({
				rect : {
					x : 0,
					y : 0,
					w : 'auto',
					h : 230
				},
				data : {
					paths : picpath,
					captions: piccaptions
				},
				styles : {
					caption : {//（可选项）JSON对象；说明文字区域样式
						height : 25.0, //（可选项）数字类型；说明文字区域高度；默认：35.0
						color : 'rgba(255,255,255,0.5)', //（可选项）字符串类型；说明文字字体颜色；默认：'#E0FFFF'
						size : 16.0, //（可选项）数字类型；说明文字字体大小；默认：13.0
						bgColor : 'rgba(0,0,0,0.5)', //（可选项）说明文字区域的背景色，支持rgb、rgba、#；默认'#696969'
						position : 'overlay' //（可选项）字符串类型；说明文字区域的显示位置，取值范围：overlay（悬浮在图片上方，底部与图片底部对齐），bottom（紧跟在图片下方，顶部与图片底部对齐）；默认：'bottom'
					},
					indicator : {//（可选项）JSON对象；指示器样式；不传则不显示指示器
						align : 'center', //(可选项)字符串类型；指示器位置，center（居中），left（靠左），right（靠右）；默认：center
						//color : 'rgba(0,200,0,0.9)', //(可选项)指示器颜色 ，支持rgb、rgba、#；默认：'#FFFFFF'
						activeColor : 'rgba(0,0,0,0.7)' //(可选项)当前指示器颜色，支持rgb、rgba、#；默认：'#DA70D6'
					}
				},
				placeholderImg : "widget://res/key1.png",
				contentMode : "scaleAspectFit",
				interval : 6,
				auto : true,
				loop : true,
				fixedOn : api.frameName,
				fixed : false
			}, function(ret, err) {
				//alert(JSON.stringify(ret));
			});
		}
	</script>
	<script type="text/javascript">
		function join_ajax(industry, area, market_id) {
			var pageParam = {
				wintitle : "加入产业带",
				type : "joinye",
				tourl : tourl,
				bounces : false
			};
			if (UserInfo.has_login()) {
				
			} else {
				pageParam.nextUrl = "../price/order-main.html";
				pageParam.winName = "joinye";
				openWin("frm-login", "../myrc/frm-login.html", pageParam);
				return;
			}
			api.showProgress({
				title : '加载中',
				modal : false
			});
			var data ={
				industry : industry,
				area : area,
				market_id : market_id
			}
			api.ajax({
				url : hosturl + 'ye/join_ye.html?t=' + (new Date()).getTime().toString(),
				method : 'post',
				timeout : 30,
				dataType : 'json',
				returnAll : false,
				data : {
					values : data
				}
			}, function(ret, err) {
				alert(JSON.stringify(ret))
				if (ret) {
					if (ret.err == "true") {
						api.toast({
						    msg: ret.result,
						    duration: 2000,
						    location: 'bottom'
						});
					} else {
						api.toast({
						    msg: ret.result,
						    duration: 2000,
						    location: 'bottom'
						});
					}
				} else {
					api.toast({
					    msg: '系统错误，请重试！',
					    duration: 2000,
					    location: 'bottom'
					});
				};
				api.hideProgress();
			});
		}
	</script>
</html>