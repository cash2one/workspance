<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>再生网登录</title>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/api.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
	<!-- 	<link rel="stylesheet" type="text/css" href="../../css/myrc/frm-login.css"/> -->
	</head>
	<style type="text/css">
		body{
			background-color: #f4f4f4;
			width: 100%;
			height: 100%;
		}
		.login-btn{
			background-color: #01ba2e;
			border: 1px solid #01ba2e
		}
		.login-btn:active{
			background-color: #01BA60;
			border: 1px solid #01BA60
		}
		.cannot-login{
			line-height: 20px;
			margin-top: 10px;
			margin:10px 15px 0px;
		}
		.forget{
			color: #666666;
			font-size: 16px;
		}
		.enroll{
			float: right;
			color: #01ba2e;
			padding-right: 18px;
			position: relative;
			font-size: 16px
		}
		.enroll i{
			position: absolute;
			height: 13px;
			width: 18px;
			display: block;
			background-image: url(../../image/imageslist.png);
		    background-size:220px 220px;
		    background-position: -54px -195px;
		    right: 0;
		    top: 4px;
		}
		.login-btn-click{
			background-color: #01aa2a
		}
		.aui-card{
			margin-top: 20px;
		}
	</style>
	<body>
		<!--</audio><div class="logo">
		<div class="logo-pic"></div>
		<p class="hint-ts">
		您需要等录后才可继续操作！
		</p>
		</div>-->

		<div class="aui-content aui-card">       
	        <div class="aui-form">
	            <div class="aui-input-row">
	                <i class="aui-input-addon aui-iconfont aui-icon-people aui-text-info"></i>
	                <input type="text" class="aui-input code-inpt" placeholder="请输入会员名/邮箱/手机"/>
	            </div>

	            <div class="aui-input-row">
	                <i class="aui-input-addon aui-iconfont aui-icon-lock aui-text-warning"></i>
	                <input type="password" id="password" class="aui-input psword-input" placeholder="请输入密码"/>
	                <i class="aui-input-addon aui-iconfont aui-icon-attention aui-text-default" tapmode onclick="showPassword();" id="showpass-btn"></i>
	            </div>
	            <div class="aui-btn-row">
	                <div class="aui-btn aui-btn-block aui-btn-warning login-btn" onclick="return false;">确认</div>
	            </div>
	        </div>
	    </div>
	    <div class="cannot-login clear">
			<span class="forget">忘记密码？</span>
			<span class="enroll">快速注册<i></i></span>
		</div>

		<!-- <div class="login-form">
			<ul class="login-form-ul">
				<li>
					<div class="input-mo">
						<div class="input-title">
							<i class="title-code"></i>账号
						</div>
						<input type="text" class="import-ipt code-inpt" placeholder="请输入会员名/邮箱/手机">
						<t class="dlet"></t>
					</div>
				</li>
				<li>
					<div class="input-mo">
						<div class="input-title">
							<i class="title-password"></i>密码
						</div>
						<input type="password" class="import-ipt psword-input" placeholder="请输入密码">
						<t class="pswoed-type">
							显示
						</t>
					</div>
				</li>
				<li>
					<span class="btn login-btn" tapmode="login-btn-click">登 录</span>
				</li>
				<li>
					<div class="cannot-login clear">
						<span class="forget">忘记密码？</span>
						<span class="enroll">快速注册<i></i></span>
					</div>
				</li>
			</ul>
		</div> -->
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/jquery.js"></script>
	<script type="text/javascript" src="../../script/jQuery.md5.js"></script>
	<script type="text/javascript" src="../../script/common.js"></script>
	<script type="text/javascript">

		function showPassword(){
	        $api.attr($api.byId('password'),'type','text');
	        $api.removeCls($api.byId('showpass-btn'),'aui-icon-attention');
	        $api.addCls($api.byId('showpass-btn'),'aui-icon-attentionfill');
	        $api.attr($api.byId('showpass-btn'),'onclick','hidePassword();');
	        api.parseTapmode();
	    }
	    function hidePassword(){
	        $api.attr($api.byId('password'),'type','password');
	        $api.removeCls($api.byId('showpass-btn'),'aui-icon-attentionfill');
	        $api.addCls($api.byId('showpass-btn'),'aui-icon-attention');
	        $api.attr($api.byId('showpass-btn'),'onclick','showPassword();');
	        api.parseTapmode();
	    }

		apiready = function() {
			var oDlet = $(".dlet");
			var pswoedType = $(".pswoed-type");
			var cInpt = $(".code-inpt");
			var psInput = $(".psword-input");
			//注册帐号
			$(".enroll").on("click", function() {
				var pageParam = {
					wintitle : "注册帐号",
					type : "register"
				};
				openWin("register", "../myrc/register.html", pageParam);
			})
			//忘记密码
			$(".forget").on("click", function() {
				var pageParam = {
					wintitle : "密码重置",
					type : "passage-revise",
				};
				openWin("passage-revise", "../myrc/passage-revise.html", pageParam);
			})
			//当输入账户显示删除按钮
			// cInpt.keyup(function() {
			// 	if ($(this).val().length != 0) {
			// 		oDlet.show();
			// 	} else {
			// 		oDlet.hide();
			// 	}
			// })
			// oDlet.on("click", function() {
			// 	cInpt.val("");
			// 	$(this).hide();
			// 	cInpt.focus();
			// })
			//当输密码弹出显示字样
			// psInput.keyup(function() {
			// 	if ($(this).val().length != 0) {
			// 		pswoedType.show();
			// 	} else {
			// 		pswoedType.hide();
			// 	}
			// })
			//点击显示，密码成文字
			// pswoedType.on("click", function() {
			// 	if (psInput.attr("type") == "password") {
			// 		psInput.attr("type", "text");
			// 		psInput.focus();
			// 		$(this).text("隐藏")
			// 	} else {
			// 		psInput.attr("type", "password");
			// 		psInput.focus();
			// 		$(this).text("显示")
			// 	}
			// })
			// psInput.blur(function() {
			// 	if (psInput.val().length == 0) {
			// 		$(this).attr("type", "password")
			// 	}
			// })
			//点击登录
			$(".login-btn").on("click", function() {
				api.showProgress({
					title : '加载中',
					modal : false
				});
				var login_name = $(".code-inpt").val();
				var password = $(".psword-input").val();
				if (login_name.length == 0) {
					hint("帐号不能为空！");
					api.hideProgress();
					return;
				}
				if (password.length == 0) {
					hint("密码不能为空！");
					api.hideProgress();
					return;
				}
				var data = {
					username : login_name,
					passwd : password,
					appid : api.appId,
					appsystem : api.systemType,
					loginflag : 1
				}
				postAjax(data)
			})
		}
		function postAjax(data) {
			$(".login-btn").removeClass("login-btn");
			api.ajax({
				url : hosturl + 'loginof.html?datatype=json',
				method : 'post',
				timeout : 30,
				dataType : 'json',
				data : {
					values : data
				},
				returnAll : false
			}, function(ret, err) {
				if (ret) {
					//alert(JSON.stringify(ret));
					if (ret.err == 'false') {
						$(".btn").addClass("login-btn");
						//密码加密
						var pwd_hash = UserInfo.get_pwd_hash(data.passwd);
						//登入获取的token
						var token = ret.token;
						//登录获取的mid
						var memberID = ret.result.company_id;
						//登录获取的mid
						var contact = ret.result.contact;
						var username = data.username
						//保存信息到本地
						UserInfo.onSuccess(token, username, pwd_hash, memberID, contact);
						api.alert({
							title : '登录帐号',
							msg : '登录成功！',
							buttons : ['确定']
						}, function(ret, err) {
							api.execScript({
								name : 'root',
								frameName : 'my-home',
								script : 'isLogin()'
							});
							if (api.pageParam.nextUrl != null) {
								openWin(api.pageParam.winName, api.pageParam.nextUrl, api.pageParam);
								setTimeout(function() {
									api.closeWin()
								}, 1000)
							}
							api.closeWin();
						});
					} else {
						hint(ret.errkey)
						$(".btn").addClass("login-btn");
					}
					api.hideProgress();
				} else {
					$(".btn").addClass("login-btn")
					api.hideProgress();
				};
			});
		}

		function hint(ts) {
			$(".hint").remove()
			var hintHtml = '<div class="hint" style="position:fixed;color:#fff;line-height:18px;font-size:14px;width:100%">' + '<span style="display:block;margin:0 8px;background:#000;opacity:0.8;border-radius:5px;padding:10px 10px;text-align:center">' + ts + '<span>' + '</div>';
			$("body").append(hintHtml);
			var hint_height = $(".hint").height();
			var wd_height = $(window).height();
			var top_height = (wd_height - hint_height) / 2
			$(".hint").css("top", top_height + "px");
			setTimeout(function() {
				$(".hint").fadeOut("slow", function() {
					$(".hint").remove()
				})
			}, 2000)
		}
	</script>
</html>