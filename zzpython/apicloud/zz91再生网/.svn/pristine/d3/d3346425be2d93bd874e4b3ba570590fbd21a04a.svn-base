<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title></title>
		<link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/api.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
		<link rel="stylesheet" href="../../css/comm/win_blank.css" type="text/css">
		<style>
			.selectmain {
				height: 250px;
				overflow: auto;
			}
			.selectadd,.selectmy {
				text-align: left;
				line-height: 20px;
				background-color: #EBEBEB;
				padding: 5px;
				font-size: 14px;
				border-bottom: solid 1px #999;
				font-weight:bold;
			}
			.get-xinx {
				-webkit-box-flex: 1;
				-webkit-flex: 1;
				flex: 1;
				padding:10px
				
			}
			.get-xinx span {
				display: block;
				text-align: center;
				border: 1px solid #e1e1e1;
				border-radius: 3px;
				line-height: 30px;
				margin-bottom: 10px;
				position: relative;
				float:left;
				padding-right:10px;
				padding-left:10px;
				margin-right:10px;
				background-color: #F2F2F2;
				width:30%;
				
			}
			.get-xinx span font{
				width:100%;
				display:block;
				overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
			}
			.get-xinx span:last-child {
				margin-bottom: 0;
			}
			.get-xinx {
				margin-bottom: 15px;
				min-height: 37px;
			}
			.get-xinx span i {
				display: block;
				height: 30px;
				width: 30px;
				position: absolute;
				right: -15px;
				top: -15px;
				font-size:20px;
				color:#ff0000;
			}
		</style>
	</head>
	<body>
		<header>
			<div id="cloud" class="topbar  activebar">
				<div tapmode="hover-category" class="category" style="position:absolute;top:0px;left:0px;z-index:20000" onclick="api.closeWin();">
					<i></i>
				</div>
				<div class="select">
					定制行情
				</div>
			</div>
			<div class="selectmy">
				<i class="aui-iconfont aui-icon-friendfavor"></i> 我的定制
			</div>
		</header>
		<div class="selectmain" id="selectmain">
			<div class="get-xinx">
				<!--<span>杭州<i class="remove aui-iconfont aui-icon-roundclosefill"></i></span>
				<span><font>上海上海上海</font><i class="remove aui-iconfont aui-icon-roundclosefill"></i></span>
				<span>上海sf<i class="remove aui-iconfont aui-icon-roundclosefill"></i></span>
				<span>上海<i class="remove aui-iconfont aui-icon-roundclosefill"></i></span>-->
			</div>
			<div style="height:10px"></div>
		</div>
		<div class="selectadd">
			<i class="aui-iconfont aui-icon-activity"></i> 添加定制
		</div>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/common.js"></script>
	<script type="text/javascript" src="../../script/laytpl.js"></script>
	<script type="text/javascript" src="../../script/aui-alert.js" ></script>
	<script type="text/javascript">
		apiready = function() {
			var systemType = api.systemType;
			if (systemType != "ios") {
				$("header").css("padding-top", "0px")
			}
			var topHeight = $("header").height();
			var oHeight = $(".selectmain").height();
			var aHeight = $(".selectadd").height();
			var pageParam = {
				type : 'price',
			};
			api.openFrame({
				name : 'order_price',
				url : '../price/order-priceselect.html',
				rect : {
					x : 0,
					y : topHeight + oHeight + aHeight,
					w : 'auto',
					h : 'auto'
				},
				pageParam : pageParam,
				bounces : false,
				bgColor : 'rgb(255,255,255,255)',
				vScrollBarEnabled : true,
				hScrollBarEnabled : true,
				showProgress : true
			});
			//获取我的定制
			getmyorder();
			//删除定制
			$(".get-xinx").on("click", ".remove", function() {
				api.showProgress({
					title : '删除中',
					modal : true
				});
				var spanFt = $(this).parent();
				var orderid=$(this).attr("orderid")
				spanFt.hide(300, function() {
					spanFt.remove()
				})
				savedata_noback(hosturl+"order/myorderprice_del.html?company_id="+UserInfo.memberID()+"&datatype=json&orderid="+orderid)
			});
		};
		//我的定制
		function getmyorder(){
			var lists={};
			api.showProgress({
				title : '加载中',
				modal : true
			});
			lists['company_id'] = UserInfo.memberID();
			lists['usertoken'] = UserInfo.token();
			lists['appsystem'] = api.systemType;
			lists['datatype'] = 'json';
			api.ajax({
				url : hosturl + 'order/myorderprice.html?'+(new Date()).getTime().toString(),
				method : 'post',
				timeout : 30,
				dataType : 'json',
				returnAll : false,
				data : {
					values : lists
				}
			}, function(ret, err) {
				//alert(JSON.stringify(ret))
				if (ret) {
					if (ret.err == "true") {
					} else {
						$.each(ret.listall, function(index, item) {
							var order_span = '<span><font>' + item.label + '</font><i class="remove aui-iconfont aui-icon-roundclosefill" orderid="'+item.id+'"></i></span>';
							$(".get-xinx").append(order_span);
						})
					}
				} else {
					api.toast({
					    msg: '系统错误',
					    duration: 2000,
					    location: 'bottom'
					});
				};
				api.hideProgress();
				loadinghide();
			});
		}
		//添加定制
		function intoOrder(lists) {
			//alert(JSON.stringify(lists))
			//lists=JSON.parse(lists);
			lists['company_id'] = UserInfo.memberID();
			lists['usertoken'] = UserInfo.token();
			lists['appsystem'] = api.systemType;
			lists['datatype'] = 'json';
			api.showProgress({
				title : '定制中',
				modal : true
			});
			saveorder(lists)
		}
		function saveorder(data){
			api.ajax({
				url : hosturl + 'order/myorderprice_save.html',
				method : 'post',
				timeout : 30,
				dataType : 'json',
				returnAll : false,
				data : {
					values : data
				}
			}, function(ret, err) {
				//alert(JSON.stringify(ret))
				if (ret) {
					if (ret.err == "true") {
						api.toast({
						    msg: ret.errkey,
						    duration: 2000,
						    location: 'bottom'
						});
					} else {
						var order_span = '<span><font>' + data['label'] + '</font><i class="remove aui-iconfont aui-icon-roundclosefill" orderid="'+ret.orderid+'"></i></span>';
						$(".get-xinx").append(order_span);
						var div = document.getElementById('selectmain');
						div.scrollTop = div.scrollHeight;
					}
				} else {
					api.toast({
					    msg: '系统错误',
					    duration: 2000,
					    location: 'bottom'
					});
				};
				api.hideProgress();
				loadinghide();
			});
		}
	</script>
</html>