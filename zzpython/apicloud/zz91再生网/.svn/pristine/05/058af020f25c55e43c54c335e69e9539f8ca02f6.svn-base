<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>注册帐号</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/common.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/myrc/register.css"/>
</head>
<body>
  <div class="logo">
  	<div class="logo-pic">
  	</div>
  </div>
  <div class="reg-into">
    <input type="text" placeholder="手机号码即您的登录用户名" class="userName" maxlength="11">
  </div>
  <div class="reg-into"><input type="password" placeholder="请设置6-8位密码" class="passwd" maxlength="8"></div>
  <div class="reg-into"><input type="text" placeholder="请输入您的邮箱" class="email"></div>
  <div class="reg-into"><input type="text" placeholder="请输入您的QQ号码" class="qq"></div>
  <div class="reg-into">
    <input type="text" placeholder="请输入您的姓名" class="contact">
    <div class="issue-type radio">
      <label><input name="Fruit" type="radio" value="男" checked="" />男士</label> 
      <label><input name="Fruit" type="radio" value="女" />女士</label> 
    </div>
  </div>
  <div class="reg-into"><input type="text" placeholder="请输入您的公司名称" class="companyname"></div>
  <div class="zhushi">注：个体经营输入个体经营（姓名）</div>
  <span class="btn btn-post">立即开通账号</span>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/zepto.min.js"></script>
<script type="text/javascript" src="../../script/jquery.js"></script>
<script type="text/javascript">
apiready = function () {
    $(".btn-post").on("click",function(){
      var userName = $(".userName").val();
      var passwd = $(".passwd").val();
      var qq = $(".qq").val();
      var email = $(".email").val();
      var contact = $(".contact").val();
      var sex = $(".issue-type input:checked").val();
      var companyname = $(".companyname").val();
      var clientid = api.appId;
      var telReg = !!userName.match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/);
      //手机号不正确
      if(telReg == false){
        var ts = "您输入的用户名（手机号）有误!"
        hint(ts);
        return;
      }
      //密码不足6位
      if(passwd.length <6){
        var ts = "密码必须为是6-8位!"
        hint(ts);
        return;
      }
      var filter  = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      //邮箱不正确
      if(!filter.test(email)){
        var ts = "您输入邮箱有误!"
        hint(ts);
        return;
      }
      //qq判断
      if(isNaN(qq) || qq.length == 0){
        var ts = "您输入qq号不正确!"
        hint(ts);
        return;
      }
      //qq姓名
      if(contact.length == 0){
        var ts = "姓名不能为空!"
        hint(ts);
        return;
      }
      //qq公司
      if(companyname.length == 0){
        var ts = "公司称不能为空!"
        hint(ts);
        return;
      }
      var data ={
        userName:userName,
        passwd:passwd,
        qq:qq,
        email:email,
        contact:contact,
        sex:sex,
        companyname:companyname,
        clientid:clientid
      }
      postAjax(data);
    })
}
function postAjax(data){
  $(".btn-post").removeClass("btn-post");
  api.ajax({
    url : hosturl + 'regsave.html',
    method : 'post',
    timeout : 30,
    dataType : 'json',
    data:{
      values:data
    },
    returnAll : false
  }, function(ret, err) {
    // alert(JSON.stringify(ret))
    if (ret) {
      $(".btn").addClass("btn-post")
      if(ret.err == 'false'){
        api.alert({
            title: '注册帐号',
            msg: '注册成功！',
            buttons:['确定']
        },function(ret,err){
          api.closeWin();
        });
      }else{
        $(".btn").addClass("btn-post")
        hint(ret.errkey)
      }
    } else {
    };
  });
}
function  hint(ts){
  $(".hint").remove()
  var hintHtml = '<div class="hint" style="position:fixed;color:#fff;line-height:18px;font-size:14px;width:100%">'
  +'<span style="display:block;margin:0 8px;background:#000;opacity:0.8;border-radius:5px;padding:10px 10px;text-align:center">'+ts+'<span>'
  +'</div>';
  $("body").append(hintHtml);
  var hint_height =$(".hint").height();
  var wd_height =$(window).height();
  var top_height = (wd_height - hint_height)/2
  $(".hint").css("top",top_height+"px");
  setTimeout(function(){
    $(".hint").fadeOut("slow",function(){
      $(".hint").remove()
    })
  },2000)
}
</script>
</html>