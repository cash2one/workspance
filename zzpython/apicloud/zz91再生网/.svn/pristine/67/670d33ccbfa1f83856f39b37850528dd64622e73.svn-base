<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>资讯中心-导航</title>
		<link rel="stylesheet" type="text/css" href="../../css/api.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/comm/infomation-heart.css"/>
	</head>
	<body>
		<div class="nav-heart" id="header">
			<ul class="nav-heart-ul clear" id="wrapper">
				<!-- <li class="current-nav">行业资讯</li>
				<li>评论预测</li>
				<li>技术文库</li>
				<li>政策法规</li> -->
			</ul>
			<span class="current-nav-bottom" id="navmark"></span>
		</div>
		<!-- <ul class="cantop-mation">
			<li>
				<img src="../image/infoimage.png" width="56" height="48" class="mation-pic">
				<div class="mation-title">
					亚洲PPPPPPPPPPPPPPPPPPPPPP
				</div>
				<div class="summary">
					亚洲PPPPPPPPPPPPPPPPPPP是的所得税打PP是滴是滴是滴是滴大师打撒... <span class="go-top">置顶</span>
				</div>
			</li>
		</ul> -->
	<!-- 	<ul class="cantop-mation">
			<li>
				<img src="../image/infoimage.png" width="56" height="48" class="mation-pic">
				<div class="mation-title">
					亚洲PPPPPPPPPPPPPPPPPPPPPP
				</div>
				<div class="summary">
					亚洲PPPPPPPPPPPPPPPPPPP是的所得税打PP是滴是滴是滴是滴大师打撒... <span class="click-number"><i class="see-img"></i>10</span>
				</div>
			</li>
		</ul> -->
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/jquery.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../script/common.js"></script>
	<script type="text/javascript" src="../../script/laytpl.js"></script>
	<script type="text/javascript" src="../../script/iscroll.js"></script>
	<script type="text/javascript">
		var myScroll;
		var navwidth = 0, navliwidth = 0;
		var typelist = [];
		apiready = function() {
			try {
				api.showProgress({
					title : '加载中',
					modal : false
				});
				getNavlist();
				openFirst()
				fixIos7Bar($(".header"));
			} catch (e) {
			}
			//打开第一个
		}
		//打开推荐页
		// function openFirst(){
		//   var m=0,tid=0;
		//   openFrame(tid,m);
		// }
		function getNavlist() {
			var nav_list = api.pageParam.nav_list;
			var frame_url = api.pageParam.frame_url;
			var topnumber = api.pageParam.topnumber;
			var bounces = api.pageParam.bounces;
			var nav_html = "";
			frames = [];
			$.each(nav_list, function(index, item) {
				var frame = {}, active = index == 0 ? 'current-nav' : '';
				nav_html += "<li data-index='" + index + "' id='" + index + "' class='" + active + "' onclick='openFrame(" + index + "," + index + ")'>" + item.typename + "</li>";
				frame.name = 'frame_' + index;
				frame.url = frame_url[index];
				if(frame_url.length == 1){
					frame.url = frame_url[0];
				}
				//frame.url='../html/sexmain.html?typeid=' + ret[i].id.toString();
				frame.pageParam = {
					typeid : item.id,
					index : index,
					id:api.pageParam.id
				};
				frame.bounces = true;
				if(bounces == false){
					frame.bounces = false;
				}
				// frame.name = "name" + index
				//添加打开openFrameGroup对象
				frames.push(frame);
				typelist.push(index);
			})
			$(".nav-heart-ul").html(nav_html);
			//给nav-heart li重新赋值宽度
			navliwidth = $("body").width()/topnumber;
			//给current-nav-bottom重新赋值宽度
			$(".current-nav-bottom").width(navliwidth);
			$(".nav-heart li").width(navliwidth);
			var nav_width = navliwidth * nav_list.length;
			//给nav-heart重新赋值宽度
			$(".nav-heart-ul").width(nav_width);
			api.hideProgress();
			loaded();
			openGroup(frames);
		}

		function loaded() {
			try {
				myScroll = new IScroll('#header', {
					eventPassthrough : true,
					scrollX : true,
					scrollY : false,
					preventDefault : false
				});
			} catch (e) {
				//alert(e)
			}
		}

		//加载栏目内容
		function openFrame(tid, m) {
			try {
				api.setFrameGroupIndex({
					name : 'sexgroup',
					index : m,
					scroll : true,
					showProgress : true
				});
				// api.execScript({
				//   frameName : 'frame_'+m.toString(),
				//   script : 'changesexmain(' + tid.toString() + ')'
				// });
				if (m >= 3) {
					//myScroll.scrollTo(-navliwidth * (m - 4), 0, 1000);
				} else {
					myScroll.scrollTo(0, 0, 1000)
				}
				if(tid >=3){
					var num = $(".nav-heart-ul li").width() * 2
					$api.css($api.byId('navmark'), "-webkit-transform:translate(" + num + "px,0)");
				}
				$(".nav-heart-ul").find('li').removeClass('current-nav');
				$(".nav-heart-ul").find('li').removeClass('current-nav').eq(m).addClass('current-nav');
			} catch (e) {
				//alert(e)
			}
		}

		var scrollflag = true;
		//顶部滑动栏目
		function  openGroup(frames) {
			scrollflag = false;
			var $header = $api.dom('header');
			var $body = $api.dom('body');
			var $footer = $api.byId('footer');
			var header_h = $(".nav-heart").height();
			var body_h = $api.offset($body).h;
			var rect_h = body_h - header_h;
			//判断是不是苹果手机
			var systemType = api.systemType;
		    if(systemType!="ios"){
		      header_h = header_h + 48
		    }else{
		    	header_h = header_h + 58;
		    }
			api.openFrameGroup({
				name : 'sexgroup',
				scrollEnabled : true,
				rect : {
					x : 0,
					y : header_h,
					w : 'auto',
				},
				index : 0,
				frames : frames
			}, function(ret, err) {
				//判断供求页面的底部显示
				var winName = api.winName
				if(winName == "buyinout" && ret.index!=0){
					api.closeFrame({
					    name: 'audit-foot'
					});
				}else if(winName == "buyinout" && ret.index==0){
					api.execScript({
					    frameName: 'frame_0',
					    script: "openfoot()"
					});
				}
				var num = $(".nav-heart-ul li").width() * ret.index;
				//获取头部的导航的个数
				var topnumber = api.pageParam.topnumber;
				//导航条滚动判断
				if (ret.index >= topnumber-1 && ret.index != $(".nav-heart-ul li").length-1) {
					//yScroll.scrollTo(-$("li").width() * (ret.index - 4), 0, 1000);
					myScroll.scrollTo(-navliwidth * (ret.index - (topnumber-2)), 0, 1000);
				}else if(ret.index == $(".nav-heart-ul li").length-1){
					myScroll.scrollTo(-navliwidth * (ret.index - (topnumber-1)), 0, 1000);
				}else {
					myScroll.scrollTo(0, 0, 1000);
				}
				//导航条底部滚动条滚动判断
				if (ret.index <= topnumber-2) {
					$api.css($api.byId('navmark'), "-webkit-transform:translate(" + num + "px,0)");
				}else if($(".nav-heart-ul li").length-1 == ret.index){
					num = $(".nav-heart-ul li").width() * (topnumber-1)
					$api.css($api.byId('navmark'), "-webkit-transform:translate(" + num + "px,0)");
				}else if($(".nav-heart-ul li").length - ret.index ==2 && topnumber >=4){
					num = $(".nav-heart-ul li").width() * 2
					$api.css($api.byId('navmark'), "-webkit-transform:translate(" + num + "px,0)");
				}
				else if($(".nav-heart-ul li").length - ret.index ==2 && topnumber < 4){
					num = $(".nav-heart-ul li").width() * 1
					$api.css($api.byId('navmark'), "-webkit-transform:translate(" + num + "px,0)");
				}
//				openFrame(typelist[ret.index], ret.index)
				$(".nav-heart-ul").find('li').removeClass('current-nav').eq(ret.index).addClass('current-nav');
			});
		}
	</script>
</html>