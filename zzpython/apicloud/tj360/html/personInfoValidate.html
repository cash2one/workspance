<!DOCTYPE html>
<html>
<head>
<title>工厂名称</title>
<meta charset="utf-8">
<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
<meta name="copyright" content="www.thundersoft.com" />
<link rel="stylesheet" href="../css/base.css">
<link rel="stylesheet" href="../css/common.css">
<script src="../script/api.js"></script>
<script src="../script/common.js"></script>
<style>
	html, body{
		width: 100%;
		height: 100%;
	}
	body{
		background-color: #FAFAFA;
	}
	#left {
		width:50px;
		background:url(../image/back.png) no-repeat center;
		-webkit-background-size:13px 21px;
	}
	#right{
		width:50px;
	}
	#content .title{
		padding: 30px 0 10px 20px;
		color: #999999;
	}
	#content .submit{
		display: -webkit-box;
		-webkit-box-pack: center;
		-webkit-box-align: center;
		padding-top: 20px;
	}
	#content .submit button{
		background-color: rgb(0, 184, 255);
		border:1px solid rgb(0, 184, 255);
		border-radius: 4px;
		color: #FFFFFF;
		font-weight: bold;
		width: 70%;
		padding: 10px 0;
	}
	#content .validate{
		border-top: 1px solid #D9D9D9;
		border-bottom: 1px solid #D9D9D9;
		padding: 10px 0 10px 20px;
		background-color: #FFFFFF;
	}
	
	#content input{
		width: 100%;
	}
	.confirmBtnActive{
		background-color: #00b8ff !important;
	}
</style>
</head>
<body>
	<div id="main">
		<header id='header'>
			<nav id="nav">
				<a id="left" tapmode="leftBtnActive" onclick="api.closeWin();">
				</a>
				<div id="middle">
					<strong id="title">工厂名称</strong>
				</div>
				<a id="right">
				</a>
			</nav>
		</header>
		<section id='content'>
			<div class="title">请输入你所在工厂的名称</div>
			<div class="validate"><input type="text" id="validatecode" /></div>
			<div class="submit"><button tapmode="confirmBtnActive" onclick="updateValidatecode()">确认提交</button></div>
		</section>
	</div>
</body>
<script>
	apiready = function() {
		var header = $api.byId('header');
		$api.fixIos7Bar(header);
	};
	
	function updateValidatecode(){
		var validatecode = $api.val($api.byId('validatecode'));
		if(!validatecode){
			api.toast({msg: '请输入工厂名称！', location: 'middle'});
		}else{
			//ajax提交工厂名称
			api.ajax({
		    	url: serverUrl + '/user/UpdateUser',
			    method: 'post',
			    cache: false,
			    timeout: 15,
			    dataType: 'json',
			    data: {'values': {'uid': $api.getStorage('usr').uid, 'invitationCode': validatecode}}
		    }, function(ret, err){
		    	if(ret && ret.status){
		    		api.toast({msg: '提交成功', location: 'middle'});
		    		//更新缓存
					var usr = $api.getStorage('usr');
			    	usr.fid = ret.body.fid;
			    	usr.fname = validatecode;
			    	$api.setStorage('usr', usr);
					//更新个人信息页面
					api.execScript({name: 'personInfo', frameName: 'personInfo_frame', script: 'modifyValidate("' + validatecode + '")'});
					//关闭填写工厂名称页面
					setTimeout(function(){api.closeWin();}, 2000);
		    	}else{
		    		if(ret){
		    			api.toast({msg: ret.msg, location: 'middle'});
		    		}else if(err){
		    			api.toast({msg: err.msg, location: 'middle'});
		    		}else{
		    			api.toast({msg: '数据错误', location: 'middle'});
		    		}
		    	}
		    });
		}
	}
</script>
</html>