<!DOCTYPE html>
<html lang='zh-CN'>
    <head>
        <meta charset='utf-8'>
        <meta name='viewport' content='maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,width=device-width,initial-scale=1.0'/>
        <title>微信开放平台</title>
        <link rel='stylesheet' type='text/css' href='../css/bootstrap.min.css' />
		<link rel='stylesheet' href='../css/github.css'>
		<style type='text/css'>
		  .diy-btn-group-test {margin : 10px 0px 0px 0px;}
		</style>
		
    </head>
    <body>
    </body>
	<script src="../script/jquery-1.11.1.min.js"></script>
	<script src='../script/demo.js'></script>
	<script src='../script/highlight.pack.js'></script>
	<script>
	// 设置是否开启调试模式.
	// dlog.debug = true;
	
	var demo = Demo.createNew();
	demo.show(function(){
				$('pre code').each(function(i, block) {
				    hljs.highlightBlock(block);
				  });});
	</script>
	
    <script type='text/javascript' src='../script/api.js'></script>
    <script type='text/javascript'>
    
    function getPayToken(){
        var weiXin = api.require('weiXin');
        weiXin.getToken({
                        secret:'00f373c57777e46ba86d461cbcc2fbe8'
                        },function(ret,err)
                        {
                        if (ret.status)
                        {
                            document.getElementById("paytokenis").innerHTML = ret.token;
                            document.getElementById("exipires").innerHTML = ret.expires;
                        }else
                        {
                        api.alert({msg:err.msg});
                        }
                        })
    };

function getPayOrder(){
    var weiXin = api.require('weiXin');
    weiXin.getOrder({
                       token: document.getElementById("paytokenis").innerHTML,
                       orderInfo:''
                       },function(ret,err)
                       {
                       if (ret.status)
                       {
                       document.getElementById("payorderidis").innerHTML = ret.orderId;
                       }else
                       {
                       api.alert({msg:err.msg});
                       }
                       })
};

function gotoPayOrder(){
    var weiXin = api.require('weiXin');
    weiXin.payOrder({
                       orderId: document.getElementById("payorderidis").innerHTML,
                       partnerId:'',
                       nonceStr:'',
                       timeStamp:'',
                       package:'',
                       sign:''
                       },function(ret,err)
                       {
                       if (ret.status)
                       {
                       document.getElementById("payResult").innerHTML = ret.result;
                       }else
                       {
                       api.alert({msg:err.msg});
                       }
                       })
};


    function reg(){
        var weiXin = api.require('weiXin');
        weiXin.registerApp(function(ret,err){
            if (ret.status) {
                api.alert({msg:''+ret.status});
            }else{
                api.alert({msg:'注册失败'});
            }
        })
    };

    function loginWeiXin(){
        var weiXin = api.require('weiXin');
        weiXin.auth(function(ret,err){
            if(ret.status){
                api.alert({msg: ret.token});
            }else{
                api.alert({msg: err.msg});
            }
        });

    };
    function logoutWeiXin(){
        var weiXin = api.require('weiXin');
        weiXin.cancelAuth(function(ret,err){
              if(ret.status){
                  api.alert({msg: '退出成功'});
              }else{
                  api.alert({msg: err.msg});
              }
          });
                    
    };
    function getUsersInfomation(){
        var weiXin = api.require('weiXin');
        weiXin.getUserInfo(function(ret,err){
           if(ret.status){
               api.alert({msg: '获取成功'});
           }else{
               api.alert({msg: err.msg});
           }
       });
    }
    
    function refreshUserToken(){
        var weiXin = api.require('weiXin');
        weiXin.refreshToken(function(ret,err){
            if(ret.status){
                api.alert({msg: '刷新成功'});
            }else{
                api.alert({msg: err.msg});
            }
        });
    }
    function sendReq(){
        var weiXin = api.require('weiXin');
        var scene = $('#scene').val();        
        var contentType = $('#contentType').val();         
        var title = $api.byId('title');          
        var description = $api.byId('description');         
        var thumbUrl = $api.byId('thumbUrl');     
        var contentUrl = $api.byId('contentUrl');
        var contentUrlI = $api.byId('contentUrlI');
        var contentUrlV = $api.byId('contentUrlV');
        var URL = null;
        title = title.value;
        if (contentType == 'image') {
            URL = contentUrlI.value;
        }else if(contentType == 'video'){
            URL = contentUrlV.value;
        }else if(contentType == 'music'){
            URL = contentUrlM.value;
        }else{
            URL = contentUrl.value;
        };
        description = description.value;
        thumbUrl = thumbUrl.value;

        weiXin.sendRequest({
            scene: scene,
            contentType: contentType,
            title: title,
            description: description,
            thumbUrl: thumbUrl,
            contentUrl: URL

        },function(ret,err){
            if (ret.status) {
                api.alert({
                    title: '发表微信',
                    msg: '发表成功',
                    buttons: ['确定']
                });
            }else{
                api.alert({
                    title: '发表微信',
                    msg: '发布失败',
                    buttons: ['确定']
                });
            };
        });

    };
    </script>
</html>