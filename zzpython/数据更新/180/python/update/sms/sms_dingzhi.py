#!/usr/bin/env python   #coding=utf-8   import MySQLdb   import pymssqlimport sysimport codecsimport datetimeimport structimport osreload(sys)#type = sys.getfilesystemencoding()sys.setdefaultencoding('utf-8')#---数据库连接和配置parentpath=os.path.abspath('../../')nowpath=os.path.abspath('.')execfile(parentpath+"/conn.py") cursor_sms=conn_sms.cursor()cursor_mysql_reborn=conn_mysql_reborn.cursor()execfile(parentpath+"/inc.py")#--------------------------------------#convert(bigint,gmt_editdate)>(select updatetime from import_table where tablename='"+updatetablename+"')updatetablename="sms_dingzhi"sql = "SELECT b.id, a.id AS subscribe_id, e.name AS categoryname, c.name AS areaname, d.name AS timename, b.gmt_modified"sql +=" FROM sms_subscribe a"sql +=" LEFT JOIN sms_subscribe_relate_category b ON a.id = b.subscribe_id"sql +=" LEFT JOIN sms_area c ON b.area_node_id = c.node_id"sql +=" LEFT JOIN sms_time d ON b.area_node_id = d.node_id"sql +=" LEFT JOIN sms_category e ON b.category_code = e.code where b.id>"+getlastid(updatetablename)+""cursor_mysql_reborn.execute(sql)results = cursor_mysql_reborn.fetchall()value=[]i=0for a in results:	id=str(a[0])	timename=""	areaname=""	categoryname=""	subscribe_id=str(a[1])	if(a[2]!=None):		categoryname=str(a[2]).encode('gb2312','ignore').replace("'","")	if(a[3]!=None):		areaname=str(a[3]).encode('gb2312','ignore').replace("'","")	if(a[4]!=None):		timename=str(a[4]).encode('gb2312','ignore').replace("'","")	gmt_modified=str(a[5])	#print company_name + contact_person	sql="select count(0) from sms_dingzhi where id='"+str(id)+"'"	cursor_sms.execute(sql)	oldid=cursor_sms.fetchone()	oldidcount=oldid[0]	if (oldidcount>0):		updateflag="更新"	else:		updateflag="新增"		sql="insert into sms_dingzhi(id, subscribe_id,categoryname, areaname, timename, gmt_modified)"		sql=sql+"values("+id+", "+subscribe_id+",'"+categoryname+"', '"+areaname+"', '"+timename+"', '"+gmt_modified+"')"		cursor_sms.execute(sql);		conn_sms.commit()	updatelastid(updatetablename,id)	print changezhongwen(updateflag+"成功"+str(i))	i+=1conn.close() cursor_sms.close()cursor_mysql_reborn.close()