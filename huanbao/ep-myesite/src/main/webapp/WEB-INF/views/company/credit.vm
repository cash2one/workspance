#set($layout="/layout/defaultS.vm")
<div class="container mt clearfix">
	<div class="grid_12">
        <ul class="breadcrumb">
			<li><a href="#">公司信息管理</a><span class="divider">/</span></li>
			<li>公司证书管理</li>
		</ul>
		
		#if($!{msg})
    	<div class="alert alert-info">
        	<a onclick="return false;" target="_blank">$!{msg}</a>
        </div>
		#end
		
		<div class="well mt" id="Mpic">
			<div class="well-head">公司证书管理</div>
			<div class="well-content">
				<div class="control-group" >
                    <label class="control-label">现有证书</label>
                    <div class="controls clearfix">
						#foreach($list in $!{creditList})
							<div id="creditField${list.id}" class="grid_3 center">
								<figure>
									<img src="$!{address.thumb}$!{address.resource}$!{list.picture}&width=180&height=180" width="180" height="180" class="img-polaroid" />
								</figure>
								<input id="fileNameText${list.id}" type="hidden" value="$!{list.fileName}"/>
								<input id="path${list.id}" type="hidden" value="$!{list.picture}"/>
								<p id="fileNameDiv${list.id}">$!{list.fileName}</p>
								<p>
									<a href="#springUrl('/company/deleteCredit.htm')?id=$!{list.id}" onclick="return confirm('您确定要删除吗？');" >删除</a>&nbsp;&nbsp;&nbsp;
									<a href="javascript:doUpdateFile(${list.id})">修改名称</a>
								</p>
							</div>
						#end
                    </div>
        		</div>
        		<div class="form-actions">
        			<a href="#springUrl('/company/createCredit.htm')" class="btn btn-primary" >上传新证书</a>
        		</div>
            </div>
        </div>
	</div>
</div>
<script>
	jQuery(document).ready(function(){
		myrc.select("Js_select");
		myrc.menu(7, 1);
	});
	function doUpdateFile(id) {
		var filename = jQuery("#fileNameText"+id).val();
		jQuery("#fileNameDiv"+id).html("<input id='fileName"+id+"' type='text' onchange='doUpdate("+id+")' value='"+filename+"' />");
	}
	function doUpdate(id) {
		var fileName = jQuery("#fileName"+id).val();
	    jQuery.ajax({
	        url:'#springUrl('/company/updateCredit.htm')',
	        data:{"id":id,"fileName":fileName},
	        cache:false,
	        dataType:"json",
	        type:"post",
	        success:function(req){
	        	jQuery("#fileNameDiv"+id).html(fileName);
	        	jQuery("#fileNameText"+id).val(fileName);
				window.location.href="#springUrl('/company/credit.htm')?info=1";
	        },
	        failure:function(){
	            window.location.href="#springUrl('/company/credit.htm')?info=2";
	        }
	   });
	}

</script>