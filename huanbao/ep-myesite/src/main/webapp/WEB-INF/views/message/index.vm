#set($layout="/layout/defaultS.vm")
<div class="container mt clearfix">
	<div class="grid_12">
		<ul class="breadcrumb">
			<li>
				<a href="#springUrl('/message/index.htm')">留言管理</a>
				<span class="divider">/</span>
			</li>
##			#if($!{type}=="0")
##				<li class="active">供求 收件箱</li>
##			#elseif($!{type}=="1")
##				<li class="active">求购 收件箱</li>
##			#elseif($!{type}=="2")
##				<li class="active">公司 收件箱</li>
##			#elseif($!{type}=="3")
##				<li class="active">环保客服 收件箱</li>
##			#else
##				<li class="active">收件箱</li>
##			#end

			<li >我收到的留言</li>
		</ul>

		<div class="table-select mt clearfix">
			<div class="group">
				<select class="groupSel">
					<option value="" selected >全部留言</option>
					<option value="0" >供求的留言</option>
					<option value="1" >求购的留言</option>
					<option value="2" >公司的留言</option>
					<option value="3" >客服的留言</option>
					<option value="5">技术文章留言</option>
					</select>
				</div>
				
				<div class="btn-toolbar">
					<div class="btn-group">
						<a href="javascript:void(0)" onclick="deleteInfo()" class="btn btn-small">删除</a>
					</div>
					<div class="btn-group">
						#if(!$!{readStatus} && !$!{replyStatus})
							#set($btnall="btn_active")
						#end
						<a href="#springUrl('/message/index.htm')?type=$!{type}" class="btn btn-small $!{btnall}">全部</a>
						<a href="#springUrl('/message/index.htm')?readStatus=0&type=$!{type}" class="btn btn-small #if($!{readStatus}=='0') btn_active #end">未读</a>
						<a href="#springUrl('/message/index.htm')?readStatus=1&type=$!{type}" class="btn btn-small #if($!{readStatus}=='1') btn_active #end">已读</a>
						<a href="#springUrl('/message/index.htm')?replyStatus=0&type=$!{type}" class="btn btn-small #if($!{replyStatus}=='0') btn_active #end">未回复</a>
						<a href="#springUrl('/message/index.htm')?replyStatus=1&type=$!{type}" class="btn btn-small #if($!{replyStatus}=='1') btn_active #end">已回复</a>
					</div>
				</div>
				
		</div>
		<table class="table table-bordered table-condensed">
			<thead>
				<tr>
					<th width="20" class="tac"><input type="checkbox" class="Js_checkAll" /></th>
					<th >内容</th>
					<th width="250">发件人</th>
					<th width="40" class="tac"></th>
					<th width="100" class="tac">时间</th>
				</tr>
			</thead>
			<tbody>
				#if(!$!{page.records} || $!{page.records.size()}==0)
					<tr >
						<td colspan="5">
        					<div class="alert alert-error center" >
        						<strong>注意：</strong>
        						您还没有收到任何留言信息，多发布供求信息或经常<a href="#springUrl('/supply/index.htm')" >刷新信息</a>可以让更多人看到您的信息。
								<a href="#springUrl('/supply/publish_StpOne.htm')" >发布供应信息</a>
								
								<a href="#springUrl('/buy/publish_StpOne.htm')" >发布求购信息</a>
        					</div>
						</td>
                    </tr>
				#end
				#foreach($list in $!{page.records})
				<tr id="records$!{list.message.id}">
					<td class="tac va">
						<input name="select" type="checkbox" value="$!{list.message.id}" class="inputChk"/>
					</td>
					<td style="word-wrap: break-word;word-break:break-all;">
						<a href="#springUrl('/message/messageDetails.htm')?id=$!{list.message.id}&sendStatus=$!{sendStatus}">
							#if($!{list.message.readStatus}==0)
							<strong>
								$!{list.message.title}
							</strong>
							#else
								$!{list.message.title}
							#end
						</a>
						#if($!{list.message.replyStatus}==1)
							<span class="label" >已回复</span>
						#end
##						#if($!{list.message.readStatus}==1)
##							<span class="label" >已读</span>
##						#end
						<p class="grey nomargin">
							$!{list.message.details}
						</p>
					</td>
					<td class="va">
						##<img src="http://img0.zz91.com/zz91/myrc/images/read.png" width="16" height="16" />
						
						<a target="_blank" href="$!{address.esite}/index$!{list.message.cid}.htm" class="grey">$!{list.cname}</a>
					</td>
					<td class="tac va">
						#if($!{list.message.targetType}==0)
							<span class="label" >供应</span>
						#end
						#if($!{list.message.targetType}==1)
							<span class="label" >求购</span>
						#end
						#if($!{list.message.targetType}==2)
							<span class="label" >公司</span>
						#end
						#if($!{list.message.targetType}==3)
							<span class="label" >客服</span>
						#end
						#if($!{list.message.targetType}==5)
							<span class="label">技术文章</span> 
						#end	
					</td>
					<td class="tac va">$!date.format('yyyy-MM-dd',$!{list.message.gmtCreated})</td>
				</tr>
				#end
			</tbody>
		</table>
		#myrcPageNav($!page "#springUrl('/message/index.htm')" "type=$!{type}&readStatus=$!{readStatus}&replyStatus=$!{replyStatus}" "")
	</div>
</div>

<script type="text/javascript">
	jQuery(document).ready(function(){
	
		myrc.select("Js_select");
		myrc.menu(3, 1);
		
		jQuery(".groupSel").attr("value","$!{type}"); 
		jQuery('.groupSel').val("$!{type}");
		jQuery(".groupSel").change(function(){
			var type = jQuery(".groupSel").val();
			window.location.href = "#springUrl('/message/index.htm')?type="+type
		});
		
		jQuery(".Js_checkAll").click(function(){
			var chk=jQuery(this).attr("checked")||"";
			if(chk=="checked"){
				jQuery("table .inputChk").attr("checked","checked");
			}else{
				jQuery("table .inputChk").attr("checked",null);
			}
		});
	});
	
		function deleteInfo(){
			var ids = jQuery("input[name='select']:checked")
			if(ids.length<1){
				alert("请至少选择一个进行删除!");
				return false;
			}
			if(confirm("确认删除信息?")){
				ids.each(function(){
					id = jQuery(this).val();
					if(id!=null){
						doDeleteInfo(id);
					}
				});
				
				//window.location.href="#springUrl('/message/index.htm')?type=$!{type}&readStatus=$!{readStatus}&replyStatus=$!{replyStatus}";
			}
		}
	
	function doDeleteInfo(id){
		jQuery.ajax({
			url:'#springUrl("/message/delete.htm")',
			data:{"id":id,"type":1},
			cache:false,
			dataType:"json",
			success:function(req){
				if(req.success){
					jQuery("#records"+id).remove();
				}
			},
			failure:function(){
			}
		});

	}
	
</script>