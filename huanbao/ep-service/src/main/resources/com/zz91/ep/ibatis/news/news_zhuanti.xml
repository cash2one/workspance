<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="newsZhuanti">
	<typeAlias alias="zhuanti" type="com.zz91.ep.domain.news.Zhuanti"/>
	<typeAlias alias="zhuantiDto" type="com.zz91.ep.dto.news.ZhuantiDto"/>
	
	<resultMap class="zhuanti" id="zhuantiResult">
		<result property="id" column="id"/>
		<result property="title" column="title"/>
		<result property="review" column="review"/>
		<result property="targetUrl" column="target_url"/>
		<result property="category" column="category"/>
		<result property="photoPreview" column="photo_preview"/>
		<result property="tags" column="tags"/>
		<result property="recommandStatus" column="recommand_status"/>
		<result property="attentionStatus" column="attention_status"/>
		<result property="gmtPublish" column="gmt_publish"/>
		<result property="gmtCreated" column="gmt_created"/>
		<result property="gmtModified" column="gmt_modified"/>
	</resultMap>
	
	<resultMap class="zhuantiDto" id="zhuantiDtoResult">
		<result property="zhuanti" resultMap="zhuanti.zhuantiResult" />
	</resultMap>

	<sql id="fullColumn">
	nz.id,
	nz.title,
	nz.review,
	nz.target_url,
	nz.category,
	nz.photo_preview,
	nz.tags,
	nz.recommand_status,
	nz.attention_status,
	nz.gmt_publish,
	nz.gmt_created,
	nz.gmt_modified
	</sql>
	
	<sql id ="dynamicByCategory">
		<dynamic prepend="where">
			<isNotEmpty property="category" prepend="and">
				nz.category=#category#
			</isNotEmpty>
			<isNotEmpty property="recommandStatus" prepend="and">
				nz.recommand_status=#recommandStatus#
			</isNotEmpty>
			<isNotEmpty property="attentionStatus" prepend="and">
				nz.attention_status=#attentionStatus#
			</isNotEmpty>
		</dynamic>
	</sql>
	<select id="queryByCategory" parameterClass="java.util.HashMap" resultMap="zhuantiResult">
		select 
		<include refid="newsZhuanti.fullColumn"/>
		from news_zhuanti nz
		<include refid="newsZhuanti.dynamicByCategory"/>
		<include refid="common.pageOrderBy"/>
		<include refid="common.pageLimit"/>
	</select>
	
	<select id="queryByCategoryCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		select count(*) 
		from news_zhuanti nz
		<include refid="newsZhuanti.dynamicByCategory"/>
	</select>
	
	
</sqlMap>