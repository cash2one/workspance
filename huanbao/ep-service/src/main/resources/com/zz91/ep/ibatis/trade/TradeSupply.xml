<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="tradesupply">

    <typeAlias alias="tradeSupply" type="com.zz91.ep.domain.trade.TradeSupply" />
    <typeAlias alias="tradeSupplyDto" type="com.zz91.ep.dto.trade.TradeSupplyDto"/>
    <typeAlias alias="common" type="com.zz91.ep.dto.CommonDto" />
    <typeAlias alias="tradeKeyword" type="com.zz91.ep.domain.trade.TradeKeyword"/>

    <resultMap class="tradeSupply" id="simpleDetailsResult">
        <result property="id" column="id"/>
        <result property="uid" column="uid"/>
        <result property="cid" column="cid"/>
        <result property="title" column="title"/>
        <result property="categoryCode" column="category_code"/>
        <result property="groupId" column="group_id"/>
        <result property="photoCover" column="photo_cover"/>
        <result property="provinceCode" column="province_code"/>
        <result property="areaCode" column="area_code"/>
        <result property="totalNum" column="total_num"/>
        <result property="totalUnits" column="total_units"/>
        <result property="priceNum" column="price_num"/>
        <result property="priceUnits" column="price_units"/>
        <result property="priceFrom" column="price_from"/>
        <result property="priceTo" column="price_to"/>
        <result property="useTo" column="use_to"/>
        <result property="tags" column="tags"/>
        <result property="usedProduct" column="used_product"/>
        <result property="propertyQuery" column="property_query"/>
        <result property="messageCount" column="message_count"/>
        <result property="viewCount" column="view_count"/>
        <result property="favoriteCount" column="favorite_count"/>
        <result property="plusCount" column="plus_count"/>
        <result property="htmlPath" column="html_path"/>
        <result property="integrity" column="integrity"/>
        <result property="pauseStatus" column="pause_status"/>
        <result property="checkStatus" column="check_status"/>
        <result property="gmtPublish" column="gmt_publish"/>
        <result property="gmtRefresh" column="gmt_refresh"/>
        <result property="validDays" column="valid_days"/>
        <result property="gmtExpired" column="gmt_expired"/>
        <result property="delStatus" column="del_status"/>
    </resultMap>

    <resultMap class="tradeSupply" id="detailsResult" extends="simpleDetailsResult">
        <result property="details" column="details"/>
        <result property="checkAdmin" column="check_admin"/>
        <result property="checkRefuse" column="check_refuse"/>
        <result property="gmtCheck" column="gmt_check"/>
        <result property="detailsQuery" column="details_query"/>
        <result property="infoComeFrom" column="info_come_from"/>
        <result property="tagsSys" column="tags_sys"/>
    </resultMap>

    <resultMap class="tradeSupply" id="shortSupply">
        <result property="id" column="id"/>
        <result property="categoryCode" column="category_code"/>
    </resultMap>

    <resultMap class="tradeSupply" id="longDetailsResultMap" extends="simpleDetailsResult">
        <result property="details" column="details"/>
    </resultMap>

    <resultMap class="common" id="commonResultMap">
        <result property="id" column="id" />
        <result property="title" column="title"/>
    </resultMap>
    
    <resultMap class="tradeSupply" id="simplySupplyResult" extends="commonResultMap">
         <result property="detailsQuery" column="details_query"/>
    	 <result property="gmtRefresh" column="gmt_refresh"/>
    </resultMap>

    <resultMap class="tradeSupply" id="shortDetailsResult" extends="simpleDetailsResult">
        <result property="detailsQuery" column="details_query"/>
        <result property="checkRefuse" column="check_refuse"/>
    </resultMap>

    <resultMap class="tradeSupply" id="simpleResultMap">
        <result property="id" column="id"/>
        <result property="uid" column="uid"/>
        <result property="cid" column="cid"/>
        <result property="title" column="title"/>
        <result property="categoryCode" column="category_code"/>
        <result property="photoCover" column="photo_cover"/>
        <result property="provinceCode" column="province_code"/>
        <result property="areaCode" column="area_code"/>
        <result property="totalNum" column="total_num"/>
        <result property="totalUnits" column="total_units"/>
        <result property="priceNum" column="price_num"/>
        <result property="priceUnits" column="price_units"/>
        <result property="priceFrom" column="price_from"/>
        <result property="priceTo" column="price_to"/>
        <result property="useTo" column="use_to"/>
        <result property="messageCount" column="message_count"/>
        <result property="integrity" column="integrity"/>
        <result property="gmtPublish" column="gmt_publish"/>
        <result property="gmtRefresh" column="gmt_refresh"/>
        <result property="validDays" column="valid_days"/>
        <result property="tags" column="tags"/>
    </resultMap>

    <resultMap class="tradeSupply" id="companyResultMap" extends="simpleResultMap">
        <result property="detailsQuery" column="details_query"/>
    </resultMap>

    <resultMap class="tradeSupply" id="detailsResultMap" extends="simpleResultMap">
        <result property="detailsQuery" column="details_query"/>
        <result property="details" column="details"/>
        <result property="propertyQuery" column="property_query"/>
    </resultMap>

    <resultMap class="tradeSupply" id="simpleDetailsResultMap">
        <result property="id" column="id"/>
        <result property="cid" column="cid"/>
        <result property="uid" column="uid"/>
        <result property="title" column="title"/>
        <result property="gmtPublish" column="gmt_publish"/>
    </resultMap>

    <resultMap class="tradeSupply" id="fullResultMap" extends="simpleDetailsResult">
        <result property="details" column="details"/>
        <result property="tagsSys" column="tags_sys"/>
        <result property="detailsQuery" column="details_query"/>
        <result property="checkAdmin" column="check_admin"/>
        <result property="checkRefuse" column="check_refuse"/>
        <result property="gmtCheck" column="gmt_check"/>
        <result property="gmtCreated" column="gmt_created"/>
        <result property="gmtModified" column="gmt_modified"/>
        <result property="infoComeFrom" column="info_come_from"/>
    </resultMap>

    <resultMap class="tradeKeyword" id="fullKeywordResultMap">
        <result property="id" column="id"/>
        <result property="cid" column="cid"/>
        <result property="targetId" column="target_id"/>
        <result property="start" column="start"/>
        <result property="end" column="end"/>
        <result property="keywords" column="keywords"/>
        <result property="type" column="type"/>
        <result property="status" column="status"/>
        <result property="cname" column="cname"/>
        <result property="title" column="title"/>
        <result property="photoCover" column="photo_cover"/>
        <result property="detailsQuery" column="details_query"/>
        <result property="areaCode" column="area_code"/>
        <result property="provinceCode" column="province_code"/>
        <result property="priceNum" column="price_num"/>
        <result property="priceUnits" column="price_units"/>
        <result property="memberCode" column="member_code"/>
        <result property="gmtRegister" column="gmt_register"/>
        <result property="creditFile" column="credit_file"/>
        <result property="domainTwo" column="domain_two"/>
        <result property="gmtCreated" column="gmt_created"/>
        <result property="gmtModified" column="gmt_modified"/>
    </resultMap>
    
    <resultMap class="tradeSupply" id="relevantResultMap">
        <result property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="photoCover" column="photo_cover"/>
        <result property="priceNum" column="price_num"/>
        <result property="priceUnits" column="price_units"/>
    </resultMap>

    <sql id="simpleColumn">
        ts.id,
        ts.uid,
        ts.cid,
        ts.title,
        ts.category_code,
        ts.photo_cover,
        ts.province_code,
        ts.area_code,
        ts.total_num,
        ts.total_units,
        ts.price_num,
        ts.price_units,
        ts.price_from,
        ts.price_to,
        ts.use_to,
        ts.message_count,
        ts.integrity,
        ts.gmt_publish,
        ts.gmt_refresh,
        ts.valid_days,
        ts.tags
    </sql>

    <sql id="simpleDetailsColumn">
        ts.id,
        ts.uid,
        ts.cid,
        ts.title,
        ts.category_code,
        ts.group_id,
        ts.photo_cover,
        ts.province_code,
        ts.area_code,
        ts.total_num,
        ts.total_units,
        ts.price_num,
        ts.price_units,
        ts.price_from,
        ts.price_to,
        ts.use_to,
        ts.tags,
        ts.used_product,
        ts.property_query,
        ts.message_count,
        ts.view_count,
        ts.favorite_count,
        ts.plus_count,
        ts.html_path,
        ts.integrity,
        ts.pause_status,
        ts.check_status,
        ts.gmt_publish,
        ts.gmt_refresh,
        ts.valid_days,
        ts.gmt_expired,
        ts.del_status
    </sql>

    <sql id="dynamicConditionsWhere">
        <dynamic prepend="where">
            ts.cid = #cid# and ts.del_status = 0
            <isNotEmpty property="pauseStatus">and ts.pause_status = #pauseStatus#</isNotEmpty>
            <isNotEmpty property="checkStatus">and ts.check_status = #checkStatus#</isNotEmpty>
            <isNotEmpty property="groupId">and ts.group_id = #groupId#</isNotEmpty>
            <isEqual property="overdueStatus" compareValue="0">and (now() > ts.gmt_expired and ts.valid_days !=0)</isEqual>
            <isEqual property="overdueStatus" compareValue="1">and (ts.gmt_expired > now() or ts.valid_days = 0)</isEqual>
            <isNotEmpty property="recommend">and tr.type=2</isNotEmpty>
        </dynamic>
    </sql>

    <select id="querySupplyCountByCategory" parameterClass="java.lang.String" resultClass="java.lang.Integer">select num_leaf from trade_category_num where code = #value#</select>

    <select id="querySupplysByRecommend" resultMap="commonResultMap" parameterClass="java.util.Map">
        select
            ts.id,ts.title
        from trade_recommend tr
        inner join trade_supply ts on ts.id=tr.target_id
        where ts.pause_status=0 and ts.check_status=1 and ts.del_status=0
        <isNotEmpty property="cid">and ts.cid = #cid#</isNotEmpty>
        <isNotEmpty property="type">and tr.type=#type#</isNotEmpty>
        order by tr.gmt_created desc
        limit #size#
    </select>
    
	<select id="queryNewestSupplys" resultMap="relevantResultMap" parameterClass="java.util.Map">
		<isNotEmpty property="cid">
			select id,title,photo_cover,price_num,price_units from(
		</isNotEmpty>
		select id,title,gmt_publish,photo_cover,price_num,price_units from trade_supply ts
		where
		not exists (select * from hide_info hd where ts.id=hd.target_id and hd.target_type='1')    
		and
		pause_status=0 and check_status=1 and del_status=0
		<isNotEmpty property="cid">
			and cid = #cid# and uid =#uid# 
			) OTS 
		</isNotEmpty>
		order by gmt_publish desc
		limit #size#
	</select>
		<!--
		<isNotEmpty property="category">
			and category_code like concat(#category#,'%')
		</isNotEmpty>
		-->

    <select id="queryShortDetailsById" resultMap="simpleDetailsResultMap" parameterClass="java.lang.Integer">
        select
        id,cid,uid,title,gmt_publish
        from  trade_supply ts
        where ts.check_status = 1 and ts.pause_status = 0 
        and ts.del_status = 0 and ts.id = #id#
    </select>

    <select id="queryDetailsById" resultMap="detailsResultMap" parameterClass="java.lang.Integer">
        select
        <include refid="simpleColumn"/>
        ,ts.details_query,ts.details,ts.property_query
        from trade_supply ts
        where ts.check_status = 1 and ts.pause_status = 0 and ts.del_status = 0 and ts.id = #id#
    </select>

    <update id="updateMessageCountById" parameterClass="java.lang.Integer">
        update trade_supply 
        set 
        message_count = message_count+1,
        gmt_modified = now()
        where id = #id#
    </update>

    <sql id="dynamicQuerySupplyByCompany">
        <dynamic prepend="where">
            ts.check_status = 1 and ts.pause_status = 0 and ts.del_status = 0
            <isNotEmpty property="cid">and ts.cid=#cid#</isNotEmpty>
            <isNotEmpty property="group">and ts.group_id=#group#</isNotEmpty>
            <isNotEmpty property="keywords">and ts.title like concat('%',#keywords#,'%')</isNotEmpty>
        </dynamic>
    </sql>

    <select id="querySupplyByCompany" resultMap="companyResultMap" parameterClass="java.util.HashMap">
        select
        <include refid="simpleColumn"/>
        ,ts.details_query
        from trade_supply ts
        <include refid="dynamicQuerySupplyByCompany"/>
        <include refid="common.pageOrderBy"/>
        <include refid="common.pageLimit"/>
    </select>

    <select id="querySupplyByCompanyCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
        select count(*) from trade_supply ts
        <include refid="dynamicQuerySupplyByCompany"/>
    </select>

    <select id="queryRecommendSupplysByCid" resultMap="simpleResultMap" parameterClass="java.util.Map">
        select
        <include refid="simpleColumn"/>
        from trade_recommend tr
        inner join trade_supply ts on ts.id=tr.target_id
        where ts.pause_status=0 and ts.check_status=1 and ts.del_status=0 and tr.type=2
        <isNotEmpty property="cid">and ts.cid = #cid#</isNotEmpty>
        order by tr.gmt_created desc
        limit #size#
    </select>
    <!-- 统计 -->
    <select id="getTradeSupplyCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
        select count(*) 
        from trade_supply 
        where uid = #uid#
        and del_status=0
        <isNotEmpty property="checkStatus">and check_status=#checkStatus#</isNotEmpty>
    </select>

    <update id="updatePhotoCoverById" parameterClass="java.util.Map">
        update trade_supply 
            set photo_cover = #photoCover#,
            gmt_modified=now()
        where id = #id# and cid = #cid#
    </update>

    <insert id="insertTradeSupply" parameterClass="tradeSupply">
        insert into trade_supply
            (
            uid,
            cid,
            title,
            details,
            category_code,
            province_code,
            area_code,
            total_num,
            total_units,
            price_num,
            price_units,
            price_from,
            price_to,
            use_to,
            used_product,
            tags,
            tags_sys,
            details_query,
            property_query,
            html_path,
            integrity,
            gmt_publish,
            gmt_refresh,
            valid_days,
            check_status,
            gmt_created,
            gmt_modified,
            gmt_expired,
            photo_cover,
            info_come_from)
            VALUES
            (
            #uid#,
            #cid#,
            #title#,
            #details#,
            #categoryCode#,
            #provinceCode#,
            #areaCode#,
            #totalNum#,
            #totalUnits#,
            #priceNum#,
            #priceUnits#,
            #priceFrom#,
            #priceTo#,
            #useTo#,
            #usedProduct#,
            #tags#,
            #tagsSys#,
            #detailsQuery#,
            #propertyQuery#,
            #htmlPath#,
            #integrity#,
            #gmtPublish#,
            #gmtRefresh#,
            #validDays#,
            #checkStatus#,
            now(),
            now(),
            #gmtExpired#,
            #photoCover#,
            #infoComeFrom#
            )
        <selectKey keyProperty="id" resultClass="java.lang.Integer">select LAST_INSERT_ID()</selectKey>
    </insert>

    <select id="querySupplyByConditions" resultMap="shortDetailsResult" parameterClass="java.util.Map">
        select
        <include refid="simpleDetailsColumn"/>
        ,ts.details_query,check_refuse
        from 
            trade_supply ts
        <isNotEmpty property="recommend">inner join trade_recommend tr on tr.target_id=ts.id</isNotEmpty>
        <include refid="dynamicConditionsWhere"/>
        <include refid="common.pageOrderBy"/>
        <include refid="common.pageLimit"/>
    </select>

    <select id="querySupplyByConditionsCount" resultClass="java.lang.Integer" parameterClass="java.util.Map">
        select count(*)
        from 
            trade_supply ts
        <isNotEmpty property="recommend">inner join trade_recommend tr on tr.target_id=ts.id</isNotEmpty>
        <include refid="dynamicConditionsWhere"/>
    </select>

    <update id="updateDelStatusById" parameterClass="java.util.Map">
        update trade_supply set
            del_status = 1
            ,gmt_modified = now()
        <dynamic prepend="where">
            <isNotEmpty property="id" prepend="and"> id  =  #id# </isNotEmpty>
            <isNotEmpty property="cid" prepend="and"> cid = #cid# </isNotEmpty>
        </dynamic>
    </update>

    <update id="updateRefreshById" parameterClass="java.util.Map">
        update trade_supply set
            gmt_refresh = now(),
            gmt_expired = date_add(now(),INTERVAL valid_days day),
            gmt_modified = now()
        where id = #id# and cid=#cid#
    </update>

    <update id="updatePauseStatusById" parameterClass="java.util.Map">
        update trade_supply set
            pause_status = #newStatus#
            ,gmt_modified = now()
        where id = #id# and cid=#cid#
    </update>

    <update id="updateSupplyGroupIdById" parameterClass="java.util.Map">
        update trade_supply set
            group_id = #gid#
            ,gmt_modified = now()
        where id = #id# and cid=#cid#
    </update>

    <select id="queryUpdateSupplyById" resultMap="longDetailsResultMap" parameterClass="java.util.Map">
        select
        <include refid="simpleDetailsColumn"/>
        ,ts.details
        from trade_supply ts
        where ts.id = #id# and ts.cid=#cid# and ts.del_status = 0
    </select>

    <update id="updateCategoryById" parameterClass="java.util.Map">
        update trade_supply set
            category_code = #category#,
            property_query = #propertyValue#,
            gmt_modified = now()
        where id = #id# and cid=#cid#
    </update>

    <update id="updateBaseSupplyById" parameterClass="java.util.Map">
        update trade_supply set
            title = #supply.title#,
            details = #supply.details#,
            province_code = #supply.provinceCode#,
            area_code = #supply.areaCode#,
            total_num = #supply.totalNum#,
            total_units = #supply.totalUnits#,
            price_num = #supply.priceNum#,
            price_units = #supply.priceUnits#,
            price_from  = #supply.priceFrom#,
            price_to = #supply.priceTo#,
            tags = #supply.tags#,
            use_to = #supply.useTo#,
            used_product = #supply.usedProduct#,
            details_query = #supply.detailsQuery#,
            check_status = #supply.checkStatus#,
            valid_days = #supply.validDays#,
            photo_cover=#supply.photoCover#,
		    <isNotEmpty property="supply.gmtExpired">
	        	gmt_expired=#supply.gmtExpired#,
	        </isNotEmpty>
	        gmt_refresh = now(),
            gmt_modified = now()
        where id = #id# and cid=#cid#
    </update>

    <update id="updatePropertyQueryById" parameterClass="java.util.Map">
        update trade_supply 
        set property_query = concat(property_query,#properyValue#,";"),
        gmt_refresh=now(),
        gmt_modified = now()
        where id=#id#
    </update>

    <select id="queryOneSupplyById" parameterClass="java.lang.Integer" resultMap="detailsResult">
        select
        <include refid="simpleDetailsColumn"/>
        ,ts.details,ts.check_admin,ts.check_refuse,
        ts.gmt_check,ts.details_query,ts.info_come_from,ts.tags_sys
        from trade_supply ts
        where ts.id=#id#
    </select>

    <select id="queryImpTradeSupply" resultMap="fullResultMap" parameterClass="java.lang.Integer">
        SELECT
            `id`,
            `uid`,
            `cid`,
            `title`,
            `details`,
            `category_code`,
            `group_id`,
            `photo_cover`,
            `province_code`,
            `area_code`,
            `total_num`,
            `total_units`,
            `price_num`,
            `price_units`,
            `price_from`,
            `price_to`,
            `use_to`,
            `used_product`,
            `tags`,
            `tags_sys`,
            `details_query`,
            `property_query`,
            `message_count`,
            `view_count`,
            `favorite_count`,
            `plus_count`,
            `html_path`,
            `integrity`,
            `gmt_publish`,
            `gmt_refresh`,
            `valid_days`,
            `gmt_expired`,
            `del_status`,
            `pause_status`,
            `check_status`,
            `check_admin`,
            `check_refuse`,
            `gmt_check`,
            `gmt_created`,
            `gmt_modified`,
            `info_come_from`
        FROM `trade_supply` where id > #value#
    </select>

    <update id="updateImpTradeSupply" parameterClass="java.lang.Integer">
        update trade_supply set gmt_modified = DATE_ADD(now(),INTERVAL (id - #value# + 300) SECOND) where id > #value#
    </update>

    <select id="queryBwListByKeyword" parameterClass="java.lang.String" resultMap="fullKeywordResultMap">
        select
        id,
        cid,
        target_id,
        start,
        end,
        keywords,
        type,
        status,
        cname,
        title,
        photo_cover,
        details_query,
        area_code,
        province_code,
        price_num,
        price_units,
        member_code,
        gmt_register,
        credit_file,
        domain_two,
        gmt_created,
        gmt_modified
        from trade_keyword
        where status=1 and now() > start and end > now() and keywords=#keywords#
    </select>

    <update id="updateGmtModefiled" parameterClass="java.lang.Integer">
        update trade_supply set gmt_modified = now() where id = #value#
    </update>

    <resultMap class="tradeSupply" id="randomResult">
        <result property="id" column="id"/>
        <result property="cid" column="cid"/>
        <result property="title" column="title"/>
        <result property="priceNum" column="price_num"/>
        <result property="priceUnits" column="price_units"/>
        <result property="photoCover" column="photo_cover"/>
    </resultMap>

    <select id="queryRandomSupply" parameterClass="java.util.HashMap" resultMap="randomResult">
        SELECT
            `id`,
            `cid`,
            `title`,
            `price_num`,
            `price_units`,
            photo_cover 
        FROM `trade_supply` 
        where del_status = 0 and pause_status = 0 and check_status = 1
        <isNotEmpty prepend="and" property="code">
        	category_code = #code#
        </isNotEmpty>
        order by gmt_refresh
        limit #random#,5
    </select>

    <select id="queryCategoryByCid" parameterClass="java.lang.Integer" resultMap="shortSupply">
        select id,category_code from trade_supply
        where cid=#value#
        group by category_code
        order by gmt_modified desc limit 10
    </select>

    <resultMap class="tradeSupply" id="defaultResult">
        <result property="id" column="id"/>
        <result property="uid" column="uid"/>
        <result property="cid" column="cid"/>
        <result property="title" column="title"/>
        <result property="categoryCode" column="category_code"/>
        <result property="groupId" column="group_id"/>
        <result property="photoCover" column="photo_cover"/>
        <result property="provinceCode" column="province_code"/>
        <result property="areaCode" column="area_code"/>
        <result property="totalNum" column="total_num"/>
        <result property="totalUnits" column="total_units"/>
        <result property="priceNum" column="price_num"/>
        <result property="priceUnits" column="price_units"/>
        <result property="priceFrom" column="price_from"/>
        <result property="priceTo" column="price_to"/>
        <result property="useTo" column="use_to"/>
        <result property="tags" column="tags"/>
        <result property="usedProduct" column="used_product"/>
        <result property="propertyQuery" column="property_query"/>
        <result property="messageCount" column="message_count"/>
        <result property="viewCount" column="view_count"/>
        <result property="favoriteCount" column="favorite_count"/>
        <result property="plusCount" column="plus_count"/>
        <result property="htmlPath" column="html_path"/>
        <result property="gmtPublish" column="gmt_publish"/>
        <result property="gmtRefresh" column="gmt_refresh"/>
        <result property="validDays" column="valid_days"/>
        <result property="gmtExpired" column="gmt_expired"/>
        <result property="detailsQuery" column="details_query"/>
    </resultMap>

    <sql id="defaultColumn">
        ts.id,
        ts.uid,
        ts.cid,
        ts.title,
        ts.category_code,
        ts.group_id,
        ts.photo_cover,
        ts.province_code,
        ts.area_code,
        ts.total_num,
        ts.total_units,
        ts.price_num,
        ts.price_units,
        ts.price_from,
        ts.price_to,
        ts.use_to,
        ts.tags,
        ts.used_product,
        ts.property_query,
        ts.message_count,
        ts.view_count,
        ts.favorite_count,
        ts.plus_count,
        ts.html_path,
        ts.gmt_publish,
        ts.gmt_refresh,
        ts.valid_days,
        ts.gmt_expired,
        ts.details_query
    </sql>

    <select id="querySupplyOmitDetails" parameterClass="java.lang.Integer" resultMap="defaultResult">
        select
        <include refid="defaultColumn"/>
        from trade_supply ts
        where id=#id#
    </select>
	
	<resultMap class="tradeSupply" id="resultSolrSupply">
		<result property="id" column="id"/>
		<result property="cid" column="cid"/>
		<result property="uid" column="uid"/>
		<result property="title" column="title"/>
		<result property="categoryCode" column="category_code"/>
		<result property="photoCover" column="photo_cover"/>
		<result property="provinceCode" column="province_code"/>
		<result property="areaCode" column="area_code"/>
		<result property="priceNum" column="price_num"/>
		<result property="priceFrom" column="price_from"/>
		<result property="priceTo" column="price_to"/>
		<result property="detailsQuery" column="details_query"/>
		<result property="gmtRefresh" column="gmt_refresh"/>
	</resultMap>
		
	<sql id="sqlSolrSupply">
		ts.id,
		ts.cid,
		ts.uid,
		ts.title,
		ts.category_code,
		ts.photo_cover,
		ts.province_code,
		ts.area_code,
		ts.price_num,
		ts.price_units,
		ts.price_from,
		ts.price_to,
		ts.details_query,
		ts.gmt_refresh
	</sql>
	
	<select id="querySolrSupplybyId" parameterClass="java.lang.Integer" resultMap="resultSolrSupply">
		select 
			<include refid="sqlSolrSupply"/>
		from trade_supply ts
		where not exists (select * from hide_info hd where ts.id=hd.target_id and hd.target_type='1')
	    and
	    id = #value#
	</select>
	
	<select id="queryPhotoCover" parameterClass="java.lang.Integer" resultClass="java.lang.String">
		select photo_cover from trade_supply where id = #value#
	</select>
	
	<select id="countSupplysOfCompanyByStatus" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		select count(*) from trade_supply ts
		<include refid="dynamicConditionsWhere"/>
	</select>
	
	<select id="querySimpleDetailsById" parameterClass="java.lang.Integer" resultMap="simplySupplyResult">
		select id,title,details_query,gmt_refresh 
		from trade_supply
		where check_status = 1 and pause_status = 0 
		and del_status = 0 and id = #id#
	</select>
	
	<select id="countForCidAndDate" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select count(0)
		from trade_supply
		where cid = #companyId# 
		and gmt_created >= #from# and #to# > gmt_created
	</select>
	
	<select id="countForCidAndTitle" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		select count(0)
		from trade_supply
		where cid = #companyId# 
		and title = #title#
	</select>
	
	<update id="updatePhotoCover" parameterClass="java.util.Map">
	    update trade_supply set photo_cover=#photoCover#  where id = #id#
	</update>
	
	<update id="updateUncheckByIdForMyesite" parameterClass="java.lang.Integer">
		update   trade_supply set check_status =0 , check_admin='',gmt_modified=now()
		where
		id = #id#
	</update>
	
</sqlMap>